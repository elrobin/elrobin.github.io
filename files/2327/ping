/**
 * @license almond 0.2.7 Copyright (c) 2011-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
function parseUri(e){for(var t=parseUri.options,n=t.parser[t.strictMode?"strict":"loose"].exec(e),i={},o=14;o--;)i[t.key[o]]=n[o]||"";return i[t.q.name]={},i[t.key[12]].replace(t.q.parser,function(e,n,o){n&&(i[t.q.name][n]=o)}),i}var requirejs,require,define;!function(e){function t(e,t){return b.call(e,t)}function n(e,t){var n,i,o,a,r,s,c,d,l,u,p=t&&t.split("/"),f=m.map,h=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(p=p.slice(0,p.length-1),e=p.concat(e.split("/")),d=0;d<e.length;d+=1)if(u=e[d],"."===u)e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||h)&&f){for(n=e.split("/"),d=n.length;d>0;d-=1){if(i=n.slice(0,d).join("/"),p)for(l=p.length;l>0;l-=1)if(o=f[p.slice(0,l).join("/")],o&&(o=o[i])){a=o,r=d;break}if(a)break;!s&&h&&h[i]&&(s=h[i],c=d)}!a&&s&&(a=s,r=c),a&&(n.splice(0,r,a),e=n.join("/"))}return e}function i(t,n){return function(){return l.apply(e,v.call(arguments,0).concat([t,n]))}}function o(e){return function(t){return n(t,e)}}function a(e){return function(t){f[e]=t}}function r(n){if(t(h,n)){var i=h[n];delete h[n],g[n]=!0,d.apply(e,i)}if(!t(f,n)&&!t(g,n))throw new Error("No "+n);return f[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function c(e){return function(){return m&&m.config&&m.config[e]||{}}}var d,l,u,p,f={},h={},m={},g={},b=Object.prototype.hasOwnProperty,v=[].slice;u=function(e,t){var i,a=s(e),c=a[0];return e=a[1],c&&(c=n(c,t),i=r(c)),c?e=i&&i.normalize?i.normalize(e,o(t)):n(e,t):(e=n(e,t),a=s(e),c=a[0],e=a[1],c&&(i=r(c))),{f:c?c+"!"+e:e,n:e,pr:c,p:i}},p={require:function(e){return i(e)},exports:function(e){var t=f[e];return"undefined"!=typeof t?t:f[e]={}},module:function(e){return{id:e,uri:"",exports:f[e],config:c(e)}}},d=function(n,o,s,c){var d,l,m,b,v,y,w=[],_=typeof s;if(c=c||n,"undefined"===_||"function"===_){for(o=!o.length&&s.length?["require","exports","module"]:o,v=0;v<o.length;v+=1)if(b=u(o[v],c),l=b.f,"require"===l)w[v]=p.require(n);else if("exports"===l)w[v]=p.exports(n),y=!0;else if("module"===l)d=w[v]=p.module(n);else if(t(f,l)||t(h,l)||t(g,l))w[v]=r(l);else{if(!b.p)throw new Error(n+" missing "+l);b.p.load(b.n,i(c,!0),a(l),{}),w[v]=f[l]}m=s?s.apply(f[n],w):void 0,n&&(d&&d.exports!==e&&d.exports!==f[n]?f[n]=d.exports:m===e&&y||(f[n]=m))}else n&&(f[n]=s)},requirejs=require=l=function(t,n,i,o,a){return"string"==typeof t?p[t]?p[t](n):r(u(t,n).f):(t.splice||(m=t,n.splice?(t=n,n=i,i=null):t=e),n=n||function(){},"function"==typeof i&&(i=o,o=a),o?d(e,t,n,i):setTimeout(function(){d(e,t,n,i)},4),l)},l.config=function(e){return m=e,m.deps&&l(m.deps,m.callback),l},requirejs._defined=f,define=function(e,n,i){n.splice||(i=n,n=[]),t(f,e)||t(h,e)||(h[e]=[e,n,i])},define.amd={jQuery:!0}}(),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),function(e,t){"function"==typeof define&&define.amd?define("util",[],t):e.util=t()}(this,function(){function e(){return window.console&&window.console.log&&localStorage.getItem("readcube-console-log")?console.log.apply?console.log.apply(console,arguments):Function.prototype.bind.call(console.log,console).apply(console,arguments):void 0}function t(){return[Date.now(),0|1e6*Math.random()].join("")}function n(e,t){var n=document.createElement("link");if(n.type="text/css",n.rel="stylesheet",n.href=e,document.getElementsByTagName("head")[0].appendChild(n),t){var i=document.createElement("img");i.onerror=t,i.src=e}}function i(e,t){var n=document.createElement("script"),i=document.getElementsByTagName("head")[0];n.onload=n.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(n.onload=n.onreadystatechange=null,t())},n.src=e,i.appendChild(n)}function o(t,n){function o(){return"undefined"!=typeof jQuery}if(o())n(jQuery);else{var a="http://ajax.googleapis.com/ajax/libs/jquery/"+t+"/jquery.min.js";i(a,function(){return o()?(jQuery.noConflict(),n(jQuery),void 0):(e("failed to load jQuery."),void 0)})}}function a(t){var n=new XMLHttpRequest;return n.withCredentials=!0,n.open("GET",t.url),n.onreadystatechange=function(){switch(this.readyState){case this.HEADERS_RECEIVED:if(200==this.status){var n=this.getResponseHeader("Content-Length");e("GET: HEADERS_RECEIVED, Content-Length:",n),t.done(n)}else t.fail(this.status);this.onreadystatechange=null,this.abort()}},n.send(),n}var r=function(){var e={};return{tic:function(){var n=t();return e[n]=Date.now(),n},toc:function(t){var n=Date.now()-e[t];return delete e[t],n}}}();return{log:e,uuid:t,timer:r,get_style:n,get_script:i,secure_jquery:o,get_content_size:a}}),window.Modernizr=function(e,t,n){function i(e){b.cssText=e}function o(e,t){return typeof e===t}function a(e,t){return!!~(""+e).indexOf(t)}function r(e,t){for(var i in e){var o=e[i];if(!a(o,"-")&&b[o]!==n)return"pfx"==t?o:!0}return!1}function s(e,t,i){for(var a in e){var r=t[e[a]];if(r!==n)return i===!1?e[a]:o(r,"function")?r.bind(i||t):r}return!1}function c(e,t,n){var i=e.charAt(0).toUpperCase()+e.slice(1),a=(e+" "+_.join(i+" ")+i).split(" ");return o(t,"string")||o(t,"undefined")?r(a,t):(a=(e+" "+x.join(i+" ")+i).split(" "),s(a,t,n))}var d,l,u,p="2.7.1",f={},h=t.documentElement,m="modernizr",g=t.createElement(m),b=g.style,v=":)",y=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),w="Webkit Moz O ms",_=w.split(" "),x=w.toLowerCase().split(" "),k={svg:"http://www.w3.org/2000/svg"},j={},C=[],E=C.slice,D=function(e,n,i,o){var a,r,s,c,d=t.createElement("div"),l=t.body,u=l||t.createElement("body");if(parseInt(i,10))for(;i--;)s=t.createElement("div"),s.id=o?o[i]:m+(i+1),d.appendChild(s);return a=["&#173;",'<style id="s',m,'">',e,"</style>"].join(""),d.id=m,(l?d:u).innerHTML+=a,u.appendChild(d),l||(u.style.background="",u.style.overflow="hidden",c=h.style.overflow,h.style.overflow="hidden",h.appendChild(u)),r=n(d,e),l?d.parentNode.removeChild(d):(u.parentNode.removeChild(u),h.style.overflow=c),!!r},T={}.hasOwnProperty;u=o(T,"undefined")||o(T.call,"undefined")?function(e,t){return t in e&&o(e.constructor.prototype[t],"undefined")}:function(e,t){return T.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=E.call(arguments,1),i=function(){if(this instanceof i){var o=function(){};o.prototype=t.prototype;var a=new o,r=t.apply(a,n.concat(E.call(arguments)));return Object(r)===r?r:a}return t.apply(e,n.concat(E.call(arguments)))};return i}),j.postmessage=function(){return!!e.postMessage},j.history=function(){return!(!e.history||!history.pushState)},j.rgba=function(){return i("background-color:rgba(150,255,150,.5)"),a(b.backgroundColor,"rgba")},j.backgroundsize=function(){return c("backgroundSize")},j.borderradius=function(){return c("borderRadius")},j.boxshadow=function(){return c("boxShadow")},j.textshadow=function(){return""===t.createElement("div").style.textShadow},j.cssgradients=function(){var e="background-image:",t="gradient(linear,left top,right bottom,from(#9f9),to(white));",n="linear-gradient(left top,#9f9, white);";return i((e+"-webkit- ".split(" ").join(t+e)+y.join(n+e)).slice(0,-e.length)),a(b.backgroundImage,"gradient")},j.csstransforms=function(){return!!c("transform")},j.csstransforms3d=function(){var e=!!c("perspective");return e&&"webkitPerspective"in h.style&&D("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(t){e=9===t.offsetLeft&&3===t.offsetHeight}),e},j.csstransitions=function(){return c("transition")},j.fontface=function(){var e;return D('@font-face {font-family:"font";src:url("https://")}',function(n,i){var o=t.getElementById("smodernizr"),a=o.sheet||o.styleSheet,r=a?a.cssRules&&a.cssRules[0]?a.cssRules[0].cssText:a.cssText||"":"";e=/src/i.test(r)&&0===r.indexOf(i.split(" ")[0])}),e},j.generatedcontent=function(){var e;return D(["#",m,"{font:0/0 a}#",m,':after{content:"',v,'";visibility:hidden;font:3px/1 a}'].join(""),function(t){e=t.offsetHeight>=3}),e},j.video=function(){var e=t.createElement("video"),n=!1;try{(n=!!e.canPlayType)&&(n=new Boolean(n),n.ogg=e.canPlayType('video/ogg; codecs="theora"').replace(/^no$/,""),n.h264=e.canPlayType('video/mp4; codecs="avc1.42E01E"').replace(/^no$/,""),n.webm=e.canPlayType('video/webm; codecs="vp8, vorbis"').replace(/^no$/,""))}catch(i){}return n},j.localstorage=function(){try{return localStorage.setItem(m,m),localStorage.removeItem(m),!0}catch(e){return!1}},j.svg=function(){return!!t.createElementNS&&!!t.createElementNS(k.svg,"svg").createSVGRect};for(var S in j)u(j,S)&&(l=S.toLowerCase(),f[l]=j[S](),C.push((f[l]?"":"no-")+l));return f.addTest=function(e,t){if("object"==typeof e)for(var i in e)u(e,i)&&f.addTest(i,e[i]);else{if(e=e.toLowerCase(),f[e]!==n)return f;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(h.className+=" "+(t?"":"no-")+e),f[e]=t}return f},i(""),g=d=null,f._version=p,f._prefixes=y,f._domPrefixes=x,f._cssomPrefixes=_,f.testProp=function(e){return r([e])},f.testAllProps=c,f.testStyles=D,f}(this,this.document),define("compatible",["util"],function(e){function t(){for(var t=["fontface","backgroundsize","borderradius","boxshadow","rgba","textshadow","generatedcontent","cssgradients","csstransforms","csstransforms3d","csstransitions","history","video","localstorage","postmessage","svg"],n=0;n<t.length;n++)if(!Modernizr[t[n]])return e.log("browser does not support "+t[n]+"."),!1;return!0}return t}),parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},define("endpoint",function(){var e={injection_root_url:"http://content.readcube.com/",services_root_url:"http://services.readcube.com/",webreader_root_url:"http://www.readcube.com/articles/",website_root_url:"http://www.readcube.com/"};return function(t){return e[t]}}),define("reader-frame",["util","endpoint"],function(e,t){function n(n,i,o){function a(){var e=n(document.body);v.overflow=e.css("overflow"),v.scrollTop=e.scrollTop(),e.scrollTop(0),e.css("overflow","hidden"),y.hide()}function r(){var e=n(document.body);y.show(),e.css("overflow",v.overflow),e.scrollTop(v.scrollTop)}function s(){window.history.pushState(x.CLOSED,null,null),b.css(C.hide),r()}function c(){window.history.pushState(x.OPENED,null,null),a(),b.css(C.show),b.focus()}function d(e){window.frames[_].postMessage(e,j)}function l(e){var t=parseUri(e),n=parseUri(window.location.toString());return t.host!=n.host&&(e=e.replace(t.host,n.host)),e}function u(){u.executed||u.reader_shown&&u.pdf_url&&(u.executed=!0,e.get_content_size({url:l(u.pdf_url),done:function(e){d({message:"pdf_size",size:e||1337})},fail:function(e){d({message:"pdf_size_fail",status:e})}}))}function p(){p.pending&&p.loaded&&(p.pending=!1,c(),u.reader_shown=!0,u())}function f(){n(window).bind("message",function(t){for(;t.originalEvent;)t=t.originalEvent;if(0!=k.indexOf(t.origin))return e.log("disallowed message origin:",t.origin),void 0;switch(t.data.message){case"load":e.log("reader frame loaded:",e.timer.toc(w)+"ms"),o.notify("reader-loaded"),p.loaded=!0,p();break;case"get_pdf_size":u.pdf_url=t.data.pdf_url,u();break;case"close":window.history.state==x.OPENED&&window.history.back()}})}function h(){n(window).bind("popstate",function(e){for(;e.originalEvent;)e=e.originalEvent;switch(e.state){case x.CLOSED:s();break;case x.OPENED:c()}})}function m(){var e=n('<iframe name="'+_+'" src="'+j+'"></iframe>');return e.css(n.extend({},C.base,C.hide)),e}function g(){window.history.pushState(x.CLOSED,null,null),y=n(document.body).children(":visible"),b=m(),h(),f(),e.log("loading reader frame..."),w=e.timer.tic(),b.appendTo(document.body),o.notify("reader-loading"),o.set_links(function(e){return 1==e.which?(p.pending=!0,p(),!1):void 0})}var b=null,v={},y=null,w=null,_="reader-frame",x={OPENED:"reader-opened",CLOSED:"reader-closed"},k=t("website_root_url"),j=[k,"reader_v2/"+encodeURIComponent(o.get_doi()),"?hash="+encodeURIComponent(i),"&parent_url="+encodeURIComponent(o.get_url())].join(""),C={base:{position:"absolute",top:0,left:0,width:"100%",height:"100%",border:"none",outline:"none"},hide:{visibility:"hidden",top:"-100%",bottom:"100%",zIndex:-1e4},show:{visibility:"visible",top:"0%",bottom:"0%",zIndex:1e4}};return{load:g}}return n}),define("ajax-api",["util","endpoint"],function(e,t){function n(n){function i(e,i){var o=["doi="+encodeURIComponent(e.get_doi()),"issn="+encodeURIComponent(e.get_issn()),"origin_page="+encodeURIComponent(e.get_type())].join("&");n.ajax({url:t("services_root_url")+"journals/injection_settings?"+o,dataType:"jsonp",success:function(e){i&&i(e)}})}function o(e,i){n.ajax({url:t("injection_root_url")+"html_status?doi="+encodeURIComponent(e.get_doi()),dataType:"jsonp",success:function(e){i&&i(e)}})}function a(t,n){function a(){r&&s&&n&&n({epdf_enabled:r.embedded_pdf_enabled,html_available:"ok"==s.status,pdf_hash:s.hash})}var r=null,s=null;e.log("checking injection settings...");var c=e.timer.tic();i(t,function(t){e.log("settings check complete:",e.timer.toc(c)+"ms",t),r=t,a()}),e.log("checking article availability...");var d=e.timer.tic();o(t,function(t){e.log("availability check complete:",e.timer.toc(d)+"ms",t),s=t,a()})}return{check_all:a}}return n}),define("page",["util"],function(e){function t(t){function n(){for(var n=0;n<t.length;n++)if(t[n].test()){d=t[n];break}return d?d.init():(e.log("publisher not supported."),!1)}function i(){return d.get_url()}function o(){return d.get_type()}function a(e){return d.notify(e)}function r(){return d.get_doi()}function s(){return d.get_issn()}function c(e){return d.set_links(e)}var d=null;return{init:n,notify:a,get_url:i,get_doi:r,get_issn:s,get_type:o,set_links:c}}return t}),define("modal",function(){function e(e){function a(){return e("<div></div>").css(i)}function r(){return e("<div></div>").css(o)}function s(){var t=e(document.body);h.scrollTop=t.scrollTop(),h.overflow=t.css("overflow"),t.scrollTop(0),t.css("overflow","hidden")}function c(){var t=e(document.body);t.css("overflow",h.overflow),t.scrollTop(h.scrollTop)}function d(i){return f||u?!1:(s(),f=!0,u=a(),p=r(),u.appendTo(document.body),p.appendTo(document.body),i.appendTo(p),p.css({width:i.outerWidth(),height:i.outerHeight()}),u.click(function(){return l(),!1}),u.fadeIn(t,function(){p.animate({top:"0%",bottom:"0%"},n,function(){f=!1})}),e(window).bind("keydown.modal",function(e){27==e.keyCode&&l()}),!0)}function l(){return f||!u?!1:(f=!0,p.animate({top:"-100%",bottom:"100%"},n,function(){p.remove(),p=null,u.fadeOut(t,function(){c(),u.remove(),u=null,f=!1})}),e(window).unbind("keydown.modal"),!0)}var u=null,p=null,f=!1,h={};return{open:d,close:l}}var t=200,n=400,i={display:"none",position:"absolute",top:0,left:0,bottom:0,right:0,backgroundColor:"rgba(0, 0, 0, 0.4)",zIndex:1e3},o={position:"absolute",top:"-100%",left:0,bottom:"100%",right:0,margin:"auto auto",outline:"none",border:"none",borderRadius:"6px",backgroundColor:"white",boxShadow:"0 0 6px 3px rgba(0, 0, 0, 0.4)",zIndex:1100,overflow:"hidden"};return e}),define("dashboard",["util","endpoint","modal"],function(e,t,n){function i(i,o){function a(t){var n=e.uuid(),o=t?" checked":"";return i(['<div class="onoffswitch">','<input type="checkbox" class="onoffswitch-checkbox" id="'+n+'"'+o+">",'<label class="onoffswitch-label" for="'+n+'">','<div class="onoffswitch-inner"></div>','<div class="onoffswitch-switch"></div>',"</label>","</div>"].join(""))}function r(e){var t=a(!!localStorage.getItem(e.key));return t.click(function(){t.find("input").attr("checked")?localStorage.setItem(e.key,1):localStorage.removeItem(e.key)}),t}function s(e){var t=i("<tr></tr>"),n=i("<td></td>").appendTo(t),o=i("<td></td>").appendTo(t);return n.append(e.label),o.append(r(e)),t}function c(){for(var e=i('<table class="table"></table>'),t=0;t<o.length;t++)e.append(s(o[t]));return e}function d(){return i('<div class="reload">Reload</div>').click(function(){window.location.reload(!0),m.close()})}function l(n){f?n&&n():e.get_style(t("injection_root_url")+"assets/reader_v2_dashboard.css",function(){h=i('<div id="readcube-dashboard"></div>').css({width:400,height:300}),h.append('<div class="title">ReadCube Settings</div>'),h.append(c()),h.append(d()),f=!0,n&&n()})}function u(){f&&m.open(h)}function p(){f&&m.close()}var f=!1,h=null,m=n(i);return{init:l,open:u,close:p}}return i}),define("nature-strategy",["util"],function(e){function t(t){function n(){return-1!=y.indexOf("www.nature.com")}function i(e){return"string"==typeof e&&w.test(e)}function o(){return t('meta[name="citation_doi"]').attr("content").substr(4)}function a(){var e=t('meta[name="prism.issn"]').attr("content");return i(e)?e:(e=t('meta[name="prism.eIssn"]').attr("content"),i(e)?e:(e=t(".issn").text().split(" ").pop(),i(e)?e:(e=t(".eissn").text().split(" ").pop(),i(e)?e:"")))}function r(){return"article"}function s(){return m=o(),g=a(),b=r(),v=t(".download-pdf"),m?v.length?!0:(e.log("could not find download link."),!1):(e.log("could not scrape doi."),!1)}function c(){return y}function d(){return m}function l(){return g}function u(){return b}function p(e){t("#articlenav li.readcube").hide();var n=v.find(".articlepdf a").attr("href");v.find("#toggle-download-links a").attr("href",n),v.find("*").unbind("click"),v.click(e)}function f(e){localStorage.getItem("readcube-debug-visual")&&v.css("background-color",e)}function h(e){switch(e){case"injection-loaded":f("lightpink");break;case"reader-loading":f("gold");break;case"reader-loaded":f("lightgreen")}}var m=null,g=null,b=null,v=null,y=window.location.toString(),w=/^\d{4}-\d{3}(\d|x){1}$/i;return{test:n,init:s,notify:h,get_url:c,get_doi:d,get_issn:l,get_type:u,set_links:p}}return t}),define("reader-v2-nature",["util","compatible","nature-strategy","reader-frame","ajax-api","page","dashboard"],function(e,t,n,i,o,a,r){function s(t){var s=o(t),c=a([n(t)]),d=r(t,[{key:"readcube-epdf-enabled",label:"epdf enabled"},{key:"readcube-debug-visual",label:"visual debug"},{key:"readcube-console-log",label:"console log"}]);t(function(){c.init()&&(c.notify("injection-loaded"),s.check_all(c,function(n){return localStorage.getItem("readcube-epdf-enabled")?(n.epdf_enabled&&n.html_available&&i(t,n.pdf_hash,c).load(),void 0):(e.log("readcube epdf disabled in localstorage"),void 0)}))}),window.readcube_settings=function(){t(function(){d.init(function(){d.open()})})}}function c(){t()&&e.secure_jquery("2.1.0",s)}return{init:c}}),require("reader-v2-nature").init();
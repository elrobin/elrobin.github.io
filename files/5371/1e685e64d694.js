'use strict';const TRACKER_HOST="app2.akanoo.com",CDN_HOST="cdn.akanoo.com";let clientId="",shopKey;class ClientNotRegisteredError{}
function sendRequest(a,d,c=()=>{},e=()=>{},b="post"){b={body:JSON.stringify(a),credentials:"include",headers:{"Content-Type":"application/json"},method:b,mode:"cors"};fetch("https://"+TRACKER_HOST+"/w/"+d,b).then(resolveResponse).then(resolveJson).then(a=>{isClientResponse(a)?c(a):e(a)}).catch(function(b){b instanceof ClientNotRegisteredError?sendClientRequest(b=>{c(b);a.clientId=b.clientId;sendRequest(a,d,c,e)},clientId):b.length&&"must be valid UUID"===b[0].message&&sendClientRequest(b=>{c(b);a.clientId=
b.clientId;sendRequest(a,d,c,e)},clientId)})}function isClientResponse(a){return void 0!==a.clientId}function resolveJson(a){return a.json()}function resolveResponse(a){return new Promise(function(d,c){return 200<=a.status&&300>a.status?d(a):403===a.status?c(new ClientNotRegisteredError):a.json().then(a=>c(a))})}
function sendClientRequest(a,d,c,e){const b={deviceHeight:window?window.screen.height:0,deviceWidth:window?window.screen.width:0,shopKey,supportsPush:"serviceWorker"in navigator&&"PushManager"in window};let f="post";c?(b.offSiteTriggerToken=c,b.destinationKey=e,f="put"):b.clientId=d?d:"";d=localStorage.getItem("akanoo-request");c=new Date;c=c.setHours(c.getHours()-1);if(!d||c>parseInt(d,10))localStorage.setItem("akanoo-request",Date.now().toString()),sendRequest(b,"client",a,void 0,f)};

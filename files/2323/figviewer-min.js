(function(j){j.fn.ThreeDots=function(a){var b=this;if((typeof a=="object")||(a==undefined)){j.fn.ThreeDots.the_selected=this;var b=j.fn.ThreeDots.update(a)}return b};j.fn.ThreeDots.update=function(B){var w,C=null;var f,x,D,b,d;var v,y;var a,z,e;if((typeof B=="object")||(B==undefined)){j.fn.ThreeDots.c_settings=j.extend({},j.fn.ThreeDots.settings,B);var c=j.fn.ThreeDots.c_settings.max_rows;if(c<1){return j.fn.ThreeDots.the_selected}var A=false;jQuery.each(j.fn.ThreeDots.c_settings.valid_delimiters,function(n,m){if(((new String(m)).length==1)){A=true}});if(A==false){return j.fn.ThreeDots.the_selected}j.fn.ThreeDots.the_selected.each(function(){w=j(this);if(j(w).children("."+j.fn.ThreeDots.c_settings.text_span_class).length==0){return true}v=j(w).children("."+j.fn.ThreeDots.c_settings.text_span_class).get(0);var p=h(w,true);var m=j(v).text();k(w,v,p);var o=j(v).text();if((z=j(w).attr("threedots"))!=undefined){j(v).text(z);j(w).children("."+j.fn.ThreeDots.c_settings.e_span_class).remove()}a=j(v).text();if(a.length<=0){a=""}j(w).attr("threedots",m);if(h(w,p)>c){curr_ellipsis=j(w).append('<span style="white-space:nowrap" class="'+j.fn.ThreeDots.c_settings.e_span_class+'">'+j.fn.ThreeDots.c_settings.ellipsis_string+"</span>");while(h(w,p)>c){y=g(j(v).text());j(v).text(y.updated_string);C=y.word;e=y.del;if(e==null){break}}if(C!=null){var n=l(w,p);if((h(w,p)<=c-1)||(n)||(!j.fn.ThreeDots.c_settings.whole_word)){a=j(v).text();if(y.del!=null){j(v).text(a+e)}if(h(w,p)>c){j(v).text(a)}else{j(v).text(j(v).text()+C);if((h(w,p)>c+1)||(!j.fn.ThreeDots.c_settings.whole_word)||(o==C)||n){while((h(w,p)>c)){if(j(v).text().length>0){j(v).text(j(v).text().substr(0,j(v).text().length-1))}else{break}}}}}}}if(m==j(j(w).children("."+j.fn.ThreeDots.c_settings.text_span_class).get(0)).text()){j(w).children("."+j.fn.ThreeDots.c_settings.e_span_class).remove()}else{if((j(w).children("."+j.fn.ThreeDots.c_settings.e_span_class)).length>0){if(j.fn.ThreeDots.c_settings.alt_text_t){j(w).children("."+j.fn.ThreeDots.c_settings.text_span_class).attr("title",m)}if(j.fn.ThreeDots.c_settings.alt_text_e){j(w).children("."+j.fn.ThreeDots.c_settings.e_span_class).attr("title",m)}}}})}return j.fn.ThreeDots.the_selected};j.fn.ThreeDots.settings={valid_delimiters:[" ",",","."],ellipsis_string:"...",max_rows:2,text_span_class:"ellipsis_text",e_span_class:"threedots_ellipsis",whole_word:true,allow_dangle:false,alt_text_e:false,alt_text_t:false};function l(b,e){if(j.fn.ThreeDots.c_settings.allow_dangle==true){return false}var a=j(b).children("."+j.fn.ThreeDots.c_settings.e_span_class).get(0);var f=j(a).css("display");var d=h(b,e);j(a).css("display","none");var c=h(b,e);j(a).css("display",f);if(d>c){return true}else{return false}}function h(b,a){var d=typeof a;if((d=="object")||(d==undefined)){return j(b).height()/a.lh}else{if(d=="boolean"){var c=i(j(b));return{lh:c}}}}function g(b){var c;var d=j.fn.ThreeDots.c_settings.valid_delimiters;b=jQuery.trim(b);var f=-1;var e=null;var a=null;jQuery.each(d,function(p,q){if(((new String(q)).length!=1)||(q==null)){return false}var r=b.lastIndexOf(q);if(r!=-1){if(r>f){f=r;e=b.substring(f+1);a=q}}});if(f>0){return{updated_string:jQuery.trim(b.substring(0,f)),word:e,del:a}}else{return{updated_string:"",word:jQuery.trim(b),del:null}}}function i(a){j(a).append("<div id='temp_ellipsis_div' style='position:absolute; visibility:hidden'>H</div>");var b=j("#temp_ellipsis_div").height();j("#temp_ellipsis_div").remove();return b}function k(u,s,f){var b=j(s).text();var w=b;var d=j.fn.ThreeDots.c_settings.max_rows;var x,y,e,a,v;var c;if(h(u,f)<=d){return}else{c=0;curr_length=w.length;curr_middle=Math.floor((curr_length-c)/2);x=b.substring(c,c+curr_middle);y=b.substring(c+curr_middle);while(curr_middle!=0){j(s).text(x);if(h(u,f)<=(d)){v=Math.floor(y.length/2);e=y.substring(0,v);c=x.length;w=x+e;curr_length=w.length;j(s).text(w)}else{w=x;curr_length=w.length}curr_middle=Math.floor((curr_length-c)/2);x=b.substring(0,c+curr_middle);y=b.substring(c+curr_middle)}}}})(jQuery);var $FV={};var $FVPending=false;var FigViewerInit=function(b,e,f,a){if($FVPending){return}$FVPending=true;$FV=$('<div id="fig-viewer" />');$FV.cont=$('<div id="fig-viewer-content" />');$FV.append($FV.cont);$FV.figs_ref=e;$FV.txt_expanded=false;$FV.thmbs_vis=false;$FV.external_page=a?true:false;var g=function(){try{var i=$FV[0];if(i&&typeof MathJax!="undefined"){MathJax.Hub.Queue(["Typeset",MathJax.Hub,i])}}catch(h){}};var d=function(){var h="/article/lightbox.action?uri="+b;$.ajax({url:h,dataFilter:function(j,i){return j.replace(/(^\/\*|\*\/$)/g,"")},dataType:"json",error:function(i,k,j){console.log(j);$FVPending=false},success:function(j){$FV.url=j.URL;FVBuildHdr(j.articleTitle,j.authors,j.uri);FVBuildFigs(j);if(typeof selected_tab!="undefined"&&selected_tab=="article"){$FVPending=false;FVBuildAbs(b,$(".article .abstract"),$(".article .articleinfo"));FVBuildRefs($(".article .references"));c();g()}else{var i="/article/"+b;console.log("fetch full article: "+i);$.ajax({url:i,success:function(k){$FVPending=false;
var l=$(k);FVBuildAbs(b,l.find(".article .abstract"),l.find(".article .articleinfo"));FVBuildRefs(l.find(".article .references"));c();g()},error:function(){$FVPending=false}})}}})};var c=function(){if(typeof(_gaq)!=="undefined"){_gaq.push(["_trackEvent","Lightbox","Display Modal",""])}$("body").append($FV);$("body").addClass("modal-active");FVSize();FVDisplayPane(f);var h;$win.bind("resize.modal",function(){clearTimeout(h);h=setTimeout(function(){FVSize()},100)})};$(this).bind("keydown",function(h){if(h.which==37||h.which==38){if($FV.thumbs.active.prev().length){t=$FV.thumbs.active.prev();FVChangeSlide(t)}return false}if(h.which==39||h.which==40){if($FV.thumbs.active.next().length){t=$FV.thumbs.active.next();FVChangeSlide(t)}return false}});d()};var FVSize=function(){var a=$win.height();var b=parseInt($FV.cont.css("marginTop"))+parseInt($FV.cont.css("marginTop"));var d=$FV.hdr.innerHeight();var c=a-b-$FV.slides.eq(0).find("div.data").innerHeight()-d;$FV.cont.css("height",a-b);$FV.figs.css("height",c-4);$FV.thumbs_cont.css("height",c-parseInt($FV.thumbs_el.css("paddingTop")));$FV.abst_pane.css("height",a-b-d);$FV.refs_pane.css("height",a-b-d);if($FV.thmbs_vis){FVThumbPos($FV.thumbs.active)}};var FVBuildHdr=function(g,b,e){$FV.hdr=$('<div class="header" />');if($FV.external_page){var a="http://dx.plos.org/"+e.replace("info:doi/","");var d='<h1><a href="'+a+'">'+g+"</a></h1>"}else{var d="<h1>"+g+"</h1>"}var c=$('<ul class="authors"></ul>');$.each(b,function(h,i){$("<li>"+i+"</li>").appendTo(c)});var f='<ul class="nav"><li class="abst">Abstract</li><li class="figs">Figures</li><li class="refs">References</li></ul>';$FV.hdr.append(d);$FV.hdr.append(c);$FV.hdr.append(f);$FV.hdr.find(".nav li").on("click",function(){FVDisplayPane(this.className)});$close=$('<span class="close" title="close" />').on("click",function(){FVClose()});$FV.hdr.append($close);$FV.cont.prepend($FV.hdr)};var FVBuildFigs=function(b){$FV.figs_pane=$('<div id="fig-viewer-figs" class="pane" />');$FV.thumbs_el=$('<div id="fig-viewer-thmbs" />');$FV.thumbs_cont=$('<div id="fig-viewer-thmbs-content" />');$FV.controls_el=$('<div id="fig-viewer-controls" />');$FV.slides_el=$('<div id="fig-viewer-slides" />');$FV.staging_el=$('<div class="staging" />');$FV.figs_set=[];var c="/article/fetchObject.action?uri=";var a=function(d){d=d.split("/");d=d.pop();d=d.split(".");d=d.slice(1);d=d.join("-");return"#"+d};$.each(b.secondaryObjects,function(){var f=(this.title?"<b>"+this.title+":</b> ":"")+this.transformedCaptionTitle;var m=this.title+" "+this.plainCaptionTitle;var d=$('<div class="thmb" data-uri="'+this.uri+'"><div class="thmb-wrap"><img src="'+c+this.uri+'&representation=PNG_I" alt="'+m+'" title="'+m+'"></div></div>').on("click",function(){FVChangeSlide($(this))});$FV.thumbs_cont.append(d);var i=$('<div class="slide" />');var g=$('<div class="data" />');var h=$('<div class="txt" />');var n=$('<div class="content" />');var e=$('<div class="text-more" />');var r='<div class="title">'+f+"</div>";var k=$('<div class="toggle less" title="view less" />');var p=a(this.uri);if($FV.external_page){p="/article/"+$FV.url+p}var l="<p>"+this.doi.replace("info:doi/","doi:")+"</p>";var q=$('<div class="figure" data-img-src="'+c+this.uri+"&representation="+this.repMedium+'" data-img-lg-src="'+c+this.uri+"&representation="+this.repLarge+'" data-img-txt="'+m+'"></div>');q.data("state",0).data("off-top",0).data("off-left",0);$FV.figs_set.push(q);var s='<div class="staging" />';var j='<div class="download"><h3>Download:</h3><div class="item"><a href="/article/'+this.uri+'/powerpoint" title="PowerPoint slide"><span class="btn">PPT</span></a></div><div class="item"><a href="/article/'+this.uri+'/largerimage" title="large image"><span class="btn">PNG</span><span class="size">'+convertToBytes(this.sizeLarge)+'</span></a></div><div class="item"><a href="/article/'+this.uri+'/originalimage" title="original image"><span class="btn">TIFF</span><span class="size">'+convertToBytes(this.sizeTiff)+"</span></a></div></div>";var o='<a class="btn lnk_context" href="'+p+'" onclick="FVClose();">Show in Context</a>';i.append(q);i.append(s);n.append(r);if(!/^\s*$/.test(this.transformedDescription)){e.append('<div class="desc">'+this.transformedDescription+"</div>")}e.append(l);h.append(k);n.append(e);h.append(n);g.append(h);g.append(o);g.append(j);i.append(g);$FV.slides_el.append(i)});$('<span class="btn-thmb-close" title="close" />').on("click",function(){$FV.figs_pane.toggleClass("thmbs-vis");$FV.thmbs_vis=$FV.thmbs_vis?false:true}).appendTo($FV.thumbs_el);$FV.thumbs_el.append($FV.thumbs_cont);$FV.slides=$FV.slides_el.find("div.slide");$FV.figs=$FV.slides_el.find("div.figure");$FV.thumbs=$FV.thumbs_el.find("div.thmb");$FV.thumbs.active=null;$('<span class="fig-btn thmb-btn"><i class="icn"></i> All Figures</span>').on("click",function(){$FV.figs_pane.toggleClass("thmbs-vis");$FV.thmbs_vis=$FV.thmbs_vis?false:true;FVThumbPos($FV.thumbs.active)}).appendTo($FV.controls_el);$FV.nxt=$('<span class="fig-btn next"><i class="icn"></i> Next</span>').on("click",function(){FVChangeSlide($FV.thumbs.active.next())
}).appendTo($FV.controls_el);$FV.prv=$('<span class="fig-btn prev"><i class="icn"></i> Previous</span>').on("click",function(){FVChangeSlide($FV.thumbs.active.prev())}).appendTo($FV.controls_el);$FV.loading=$('<div class="loading-bar"><!--[if lte IE 8]>LOADING<![endif]--></div>').appendTo($FV.controls_el);$FV.zoom=$('<div id="fv-zoom" />');$FV.zoom.min=$('<div id="fv-zoom-min" />').appendTo($FV.zoom);$FV.zoom.sldr=$('<div id="fv-zoom-sldr" />').appendTo($FV.zoom);$FV.zoom.max=$('<div id="fv-zoom-max" />').appendTo($FV.zoom);$FV.controls_el.append($FV.zoom);$FV.figs_pane.append($FV.slides_el);$FV.figs_pane.append($FV.thumbs_el);$FV.figs_pane.append($FV.controls_el);$FV.figs_pane.append($FV.staging_el);$FV.cont.append($FV.figs_pane);if($.support.touchEvents){$FV.slides_el.swipe({swipeLeft:function(e,g,h,f,d){if($FV.thumbs.active.next().length){t=$FV.thumbs.active.next();FVChangeSlide(t)}},swipeRight:function(e,g,h,f,d){if($FV.thumbs.active.prev().length){t=$FV.thumbs.active.prev();FVChangeSlide(t)}},tap:function(d,e){e.click()},threshold:25})}};var FVBuildAbs=function(b,c,d){$FV.abst_pane=$('<div id="fig-viewer-abst" class="pane cf" />');var f=$('<div class="abstract" />');if(c.size()==0){$FV.hdr.find("li.abstract").hide()}else{f.html(c.html());f.find("h2").remove();f.find('a[name="abstract0"]').remove()}var e='<div class="fv-lnk-pdf"><a href="/article/fetchObject.action?uri='+b+'&representation=PDF" target="_blank" class="btn">Download: Full Article PDF Version</a></div>';f.append(e);var a=$('<div class="info" />');a.html(d.html());$FV.abst_pane.append(f);$FV.abst_pane.append(a);$FV.cont.append($FV.abst_pane)};var FVBuildRefs=function(a){$FV.refs_pane=$('<div id="fig-viewer-refs" class="pane cf" />');var b=$('<ol class="references" />');b.html(a.html());$FV.refs_pane.append("<h3>References</h3>");$FV.refs_pane.append(b);$FV.cont.append($FV.refs_pane)};var FVDisplayPane=function(a){$FV.removeClass("abst figs refs").addClass(a);if(a=="figs"){if($FV.thumbs.active==null){if($FV.figs_ref){$FV.thumbs_cont.find('div[data-uri="'+$FV.figs_ref+'"]').trigger("click")}else{$FV.thumbs.eq(0).trigger("click")}}else{FVDisplayFig($FV.thumbs.index($FV.thumbs.active))}}};var FVChangeSlide=function(a){if(typeof(_gaq)!=="undefined"){_gaq.push(["_trackEvent","Lightbox","Slide Changed",""])}if($FV.thumbs.active!==null){$FV.thumbs.active.removeClass("active");var b=$FV.figs_set[$FV.thumbs.index($FV.thumbs.active)];var d=b.find("img");if(d.hasClass("ui-draggable")){FVDragStop(b,b.find("img"))}}$FV.thumbs.active=a;$FV.thumbs.active.addClass("active");$FV.slides.hide();var c=$FV.thumbs.index(a);var e=$FV.slides.eq(c);e.show();FVDisplayFig(c);FVFigDescripton(e);$FV.thumbs.active.next().length?$FV.nxt.removeClass("invisible"):$FV.nxt.addClass("invisible");$FV.thumbs.active.prev().length?$FV.prv.removeClass("invisible"):$FV.prv.addClass("invisible");if($FV.thmbs_vis){FVThumbPos(a)}};var FVFigDescripton=function(e){var b=e.find("div.toggle.less");var c=e.find("div.desc");var d=e.find("div.title");e.find("div.tease").remove();var a=function(){d.addClass("test-height");var g=d.height();d.removeClass("test-height");var f=d.height();var j;if(g==f){j=2}else{j=1}var h=c.html();var i=$('<div class="tease" />');i.append(h);i.wrapInner('<span class="ellipsis_text" />');i.insertAfter(d);i.ThreeDots({max_rows:j,ellipsis_string:'... <span class="toggle more">show more</span>'});i.find("span.more").click(function(){$FV.slides_el.addClass("txt-expand");$FV.txt_expanded=true})};if(!$FV.txt_expanded){a();b.click(function(){$FV.slides_el.removeClass("txt-expand");$FV.txt_expanded=false})}else{b.click(function(){$FV.slides_el.removeClass("txt-expand");$FV.txt_expanded=false;e.find("div.tease").remove();a()})}};var FVThumbPos=function(a){var c=$FV.thumbs.index(a);var f=a.outerHeight(true);var b=c*f;var d=b+f;var e=$FV.thumbs_cont.scrollTop();var g=$FV.thumbs_cont.innerHeight();if(b<e){$FV.thumbs_cont.scrollTop(b)}else{if(e+g<d){$FV.thumbs_cont.scrollTop(d-g)}}};var FVDisplayFig=function(b){$FV.loading.show();$FV.zoom.hide();var d=$FV.figs_set[b];var a=d.find("img");var c=d.data("state");switch(c){case 0:FVLoadMedImg(b);break;case 1:break;case 2:FVSizeImgToFit(d,false);a.removeClass("invisible");d.data("state",3);FVLoadLargeImg(b);break;case 3:break;case 4:FVSwitchImg($FV.figs_set[b]);$FV.loading.hide();d.data("state",5);break;case 5:$FV.loading.hide();FVSizeImgToFit(d,true);if(d.hasClass("zoom")){FVFigFunctions(d)}break}};var FVLoadMedImg=function(c){var d=$FV.figs_set[c].data("img-src");var a=$FV.figs_set[c].data("img-txt");var b=$('<img src="'+d+'" title="'+a+'" alt="'+a+'" class="med invisible">');$FV.figs_set[c].append(b);$FV.figs_set[c].data("state",1);$FV.figs_set[c].imagesLoaded(function(){$FV.figs_set[c].data("state",2);if(c==$FV.thumbs.index($FV.thumbs.active)&&$FV.hasClass("figs")){FVSizeImgToFit($FV.figs_set[c],false);$FV.figs_set[c].find("img").removeClass("invisible");$FV.figs_set[c].data("state",3);FVLoadLargeImg(c)}})};var FVLoadLargeImg=function(c){var d=$FV.figs_set[c].data("img-lg-src");
var a=$FV.figs_set[c].data("img-txt");var b=$('<img src="'+d+'" title="'+a+'" alt="'+a+'" class="lg invisible">');$FV.figs_set[c].next("div.staging").append(b);$FV.figs_set[c].next("div.staging").imagesLoaded(function(){$FV.figs_set[c].data("state",4);if(c==$FV.thumbs.index($FV.thumbs.active)&&$FV.hasClass("figs")){FVSwitchImg($FV.figs_set[c]);$FV.loading.hide();$FV.figs_set[c].data("state",5)}})};var FVSizeImgToFit=function(c,g){var b=c.find("img");var h=c.height();var e=c.width();var d=b.height();var a=b.width();var f=function(){if(e/h>a/d){b.css({height:h});b.css({marginLeft:Math.round((e-b.width())/2),marginTop:0})}else{b.css({height:Math.round(e*(d/a))});b.css({marginTop:Math.round((h-b.height())/2),marginLeft:0})}};if(g){if(h>c.data("img_l_h")&&e>c.data("img_l_w")){b.css({marginTop:Math.round((h-d)/2),marginLeft:Math.round((e-a)/2)});c.removeClass("zoom")}else{f();c.addClass("zoom")}}else{f()}};var FVSwitchImg=function(f){var a=f.find("img");var e=a.height();var b=f.next("div.staging").find("img");f.append(b);var g=b.height();var d=b.width();f.data("img_l_w",d).data("img_l_h",g);if(g<e){b.css({marginTop:Math.round((f.height()-g)/2),marginLeft:Math.round((f.width()-d)/2)})}else{b.css({height:e,marginTop:a.css("marginTop"),marginLeft:a.css("marginLeft")});f.addClass("zoom")}f.html(b.removeClass("invisible"));var c=$('<div class="drag-bx" />');f.wrapInner(c);if(f.hasClass("zoom")){FVFigFunctions(f)}};var FVFigFunctions=function(g){var a=g.find("img");var f=g.data("img_l_h");var b=g.data("img_l_w");var d=parseInt(a.css("marginTop"));var h=parseInt(a.css("marginLeft"));var i=a.height();var c=false;var e=g.find("div.drag-bx");$FV.zoom.show();$FV.zoom.sldr.slider({min:i,max:f,value:i,slide:function(l,k){j(k.value)},stop:function(l,k){if(!c){FVDragInit(g,a)}if(k.value==i){FVDragStop(g,a);c=false}else{FVSizeDragBox(g,a);c=true}}});$FV.zoom.max.on("click",function(){var k=$FV.zoom.sldr.slider("value");k=i+(f-i)/4*Math.ceil((k-i)*4/(f-i)+0.1);k=Math.min(Math.ceil(k),f);$FV.zoom.sldr.slider("value",k);j(k);FVDragInit(g,a);FVSizeDragBox(g,a);c=true});$FV.zoom.min.on("click",function(){if(!c){return false}var k=$FV.zoom.sldr.slider("value");k=i+(f-i)/4*Math.floor((k-i)*4/(f-i)-0.1);k=Math.max(Math.floor(k),i);$FV.zoom.sldr.slider("value",k);if(k<=i){a.css({height:k,marginTop:d,marginLeft:h});FVDragStop(g,a);c=false}else{j(k)}});var j=function(k){a.css({height:k,marginTop:d-Math.round((k-i)/2),marginLeft:h-Math.round(((k-i)/2)*(b/f))})};g.on("DOMMouseScroll mousewheel",function(k){var l=$FV.zoom.sldr.slider("value");if(k.originalEvent.wheelDeltaY<0){l=Math.min(l+20,f);j(l);$FV.zoom.sldr.slider("value",l)}else{if(k.originalEvent.wheelDeltaY>0){l=Math.max(l-20,i);j(l);$FV.zoom.sldr.slider("value",l)}}})};var FVDragInit=function(b,a){a.draggable({containment:"parent",stop:function(d,c){b.data("off-top",Math.abs(parseInt(a.css("marginTop")))-parseInt(a.css("top"))).data("off-left",Math.abs(parseInt(a.css("marginLeft")))-parseInt(a.css("left")))}})};var FVDragStop=function(b,a){a.draggable("destroy");a.css({top:0,left:0,});b.find("div.drag-bx").removeAttr("style");b.data("off-top",0).data("off-left",0)};var FVSizeDragBox=function(h,a){var f=h.find("div.drag-bx");var e=h.height();var k=h.width();var b=a.height();var g=a.width();var d=parseInt(a.css("marginTop"));var j=parseInt(a.css("marginLeft"));var c=isNaN(parseInt(a.css("top")))?0:parseInt(a.css("top"));var i=isNaN(parseInt(a.css("left")))?0:parseInt(a.css("left"));if(e>b){f.css({top:d*-1,height:e+d});a.css({top:d-h.data("off-top")})}else{f.css({top:(b-e+d)*-1,height:((b*2)-e)+d});a.css({top:b-e+d-h.data("off-top")})}if(k>g){f.css({left:j*-1,width:k+j});a.css({left:j-h.data("off-left")})}else{f.css({left:(g-k+j)*-1,width:((g*2)-k)+j});a.css({left:g-k+j-h.data("off-left")})}};var FVClose=function(){$FV.remove();$("body").removeClass("modal-active");$win.unbind("resize.modal");if(typeof event!=="undefined"){close_time=event.timeStamp}$FVPending=false};$(document).bind("keydown",function(a){if(a.which==27){FVClose()}});
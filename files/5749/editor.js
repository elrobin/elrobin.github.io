function VrtxEditor(){this.editorForm=null,this.contentLanguage="en",this.editorInitInputFields=[],this.editorInitSelects=[],this.editorInitCheckboxes=[],this.editorInitRadios=[],this.selectMappings={teachingsemester:["particular-semester","every-other"],examsemester:["particular-semester","every-other"],typeToDisplay:["so","nm","em"],"type-of-agreement":["other"],"program-type":["phd"]},this.needToConfirm=!0,this.multipleFieldsBoxes={},this.multipleFieldsBoxesTemplates=[],this.multipleFieldsBoxesDeferred=null,this.multipleFieldsBoxesAccordionSwitchThenScrollTo=null,this.multipleBoxesTemplatesContract=[],this.multipleBoxesTemplatesContractBuilt=null,this.isInAdmin="undefined"!=typeof vrtxAdmin,this.isReady=!1,this.introImageVersion=!1,this.isEditCloseAfterSave=!1,this.isEmbeddedEditSave=!1}var UNSAVED_CHANGES_CONFIRMATION,vrtxEditor=new VrtxEditor,accordionJson=null,accordionGrouped=null;function migrateOldDivContainersCheck(e){return/<div[^>]+class=(\'|\")([^\']*[^\"]* |)vrtx-(img-|)container( |(\'|\"))/i.test(e)}function showMigrateDialog(e){new VrtxConfirmDialog({title:vrtxAdmin.messages.oldImageContainers.convert.title,msg:vrtxAdmin.messages.oldImageContainers.convert.msg,btnTextOk:vrtxAdmin.messages.oldImageContainers.convert.yes,btnTextCancel:vrtxAdmin.messages.oldImageContainers.convert.no,onOk:function(){migrateOldDivContainersToNewImagePlugin(e)}}).open()}function migrateOldDivContainersToNewImagePlugin(e){for(var t=vrtxEditor.richtextEditorFacade,i=$($.parseHTML("<div>"+t.getValue(e)+"</div>")),n=i.find(".vrtx-container, .vrtx-img-container"),r=0,o=n.length;r<o;r++){var a=$(n[r]),s=a.children().length;if((1==s||2==s)&&a.find("> img, > p").length==s){var l=a.find("img");if(1==l.length){var d="",c=l.clone(),u=999999;a.hasClass("vrtx-container-size-xxl")?u=800:a.hasClass("vrtx-container-size-xl")?u=700:a.hasClass("vrtx-container-size-l")?u=600:a.hasClass("vrtx-container-size-m")?u=500:a.hasClass("vrtx-container-size-s")?u=400:a.hasClass("vrtx-container-size-xs")?u=300:a.hasClass("vrtx-container-size-xxs")&&(u=200);var p=c.attr("style"),m=void 0!==p&&""!=p,v=m&&-1!==p.indexOf("width:"),h=m&&-1!==p.indexOf("height:"),f=0,g=0;if(v||h){if(v){var x=/(.*)(width\:[\s]*[\d]+px[;]*)(.*)/i;2<(E=p.match(x)).length&&(f=E[2].replace(/[^0-9.]/g,"")),p=p.replace(x,"$1$3","")}if(h){var E,b=/(.*)(height\:[\s]*[\d]+px[;]*)(.*)/i;2<(E=p.match(b)).length&&(g=E[2].replace(/[^0-9.]/g,"")),p=p.replace(b,"$1$3","")}c.attr("style",p),u<f?(c.attr("width",u),c.removeAttr("height")):(0<f?c.attr("width",f):c.removeAttr("width"),0<g?c.attr("height",g):c.removeAttr("height"))}else{var C=c.attr("width");void 0!==C&&""!=C&&(f=parseInt(C,10)),(u<f||0==f&&999999!=u)&&(c.attr("width",u),c.removeAttr("height"))}var I=a.hasClass("vrtx-container-left")?"image-left":"";I+=a.hasClass("vrtx-container-right")?"image-right":"",I+=a.hasClass("vrtx-container-middle")?"image-center":"";var w=a.find("p");""!==$.trim(w.text())?(w.find("img").remove(),d=I?"image-center"==I?"<div class='"+I+"'><figure class='image-captioned'>":"<figure class='image-captioned "+I+"'>":"<figure class='image-captioned'>",d+=c[0].outerHTML+"<figcaption>"+w.html()+"</figcaption></figure>","image-center"==I&&(d+="</div>")):(I&&"image-center"!=I&&c.addClass(I),d+="image-center"==I?"<p class='image-center'>"+c[0].outerHTML+"</p>":c[0].outerHTML),""!==d&&a.replaceWith(d)}}}o&&(t.setValue(e,i.html()),t.updateInstance(),migrateOldDivContainersCheck(t.getValue(e))&&new VrtxHtmlDialog({title:vrtxAdmin.messages.oldImageContainers.notAllConverted.title,html:"<p>"+vrtxAdmin.messages.oldImageContainers.notAllConverted.msg+"</p>",btnTextOk:"Ok"}).open())}function storeInitPropValues(e){for(var t=vrtxEditor,i=e.find("input").not("[type=submit]").not("[type=button]").not("[type=checkbox]").not("[type=radio]"),n=e.find("select"),r=e.find("input[type=checkbox]:checked"),o=e.find("input[type=radio]:checked"),a=0,s=i.length;a<s;a++)t.editorInitInputFields[a]=i[a].value;for(a=0,s=n.length;a<s;a++)t.editorInitSelects[a]=n[a].value;for(a=0,s=r.length;a<s;a++)t.editorInitCheckboxes[a]=r[a].name;for(a=0,s=o.length;a<s;a++)t.editorInitRadios[a]=o[a].name+" "+o[a].value}function unsavedChangesInEditor(){if(!vrtxEditor.needToConfirm)return!(vrtxAdmin.ignoreAjaxErrors=!0);var e=vrtxEditor,t=$("#app-content > form, #contents"),i=t.find("input").not("[type=submit]").not("[type=button]").not("[type=checkbox]").not("[type=radio]"),n=i.length,r=t.find("select"),o=r.length,a=t.find("input[type=checkbox]:checked"),s=a.length,l=t.find("input[type=radio]:checked"),d=l.length;if(n!==e.editorInitInputFields.length||o!==e.editorInitSelects.length||s!==e.editorInitCheckboxes.length||d!==e.editorInitRadios.length)return!0;for(var c=0;c<n;c++)if(i[c].value!==e.editorInitInputFields[c])return!0;for(c=0;c<o;c++)if(r[c].value!==e.editorInitSelects[c])return!0;for(c=0;c<s;c++)if(a[c].name!==e.editorInitCheckboxes[c])return!0;for(c=0;c<d;c++)if(l[c].name+" "+l[c].value!==e.editorInitRadios[c])return!0;var u=t.find("textarea");if("undefined"!=typeof CKEDITOR){var p=e.richtextEditorFacade;for(c=0,len=u.length;c<len;c++){var m=p.getInstance(u[c].name);if(m&&p.isChanged(m)&&""!==p.getValue(m))return!0}}return!(vrtxAdmin.ignoreAjaxErrors=!0)}function unsavedChangesInEditorMessage(){if(unsavedChangesInEditor())return UNSAVED_CHANGES_CONFIRMATION}function validTextLengthsInEditor(e){for(var t=vrtxAdmin.cachedContent,i=validTextLengthsInEditorError,n=e?t.find("input[type=text]:not(.vrtx-multiple)"):t.find(".vrtx-string:not(.vrtx-multiple), .vrtx-resource-ref, .vrtx-image-ref, .vrtx-media-ref"),r=0,o=n.length;r<o;r++){var a=$(n[r]),s="";if(e)s=void 0!==a.val()?s=a.val():"";else{var l=a.find("input");s=l.length&&void 0!==l.val()?s=l.val():""}if(1500<s.length)return i(a,e),!1}if("undefined"!=typeof CKEDITOR){var d=e?t.find("textarea:not(#resource\\.content)"):t.find(".vrtx-simple-html, .vrtx-simple-html-small"),c=vrtxEditor.richtextEditorFacade;for(r=0,len=d.length;r<len;r++){var u=$(d[r]),p=e?u:u.find("textarea");if(p.length&&void 0!==p[0].name){var m=c.getInstance(p[0].name);if(m&&1500<c.getValue(m).length)return i(u,e),!1}}}return!0}function validTextLengthsInEditorError(e,t){$("html").scrollTop(0);var i="";if(t){var n=e.closest(".property-item");n.length&&(i=n.find(".property-label:first"))}else i=e.find("label");i=i.length?i.text():"<?>",new VrtxMsgDialog({title:messages.validationError,msg:messages.tooLongFieldPre+i+messages.tooLongFieldPost}).open()}function previewImage(e,t){if(void 0!==e){e=e.replace(/\./g,"\\.");var i=$("#"+e+"\\.preview-inner");if(i.length){var n=$("#"+e);if(n.length)makePreviewImg(n.val(),n,i.parent().prev(),i.find("img"),!1,t)}}}function makePreviewImg(l,d,c,u,p,m){var v=setNonCachedUrl(resolveAbsoluteUrl(l)),h=hasImageCaption(d,p);Validator.validate({url:v,container:c},"IS_IMAGE",function(e,t){var i=$(".vrtx-intro-image-dimensions-edit-link"),n=$(".vrtx-intro-image-preview-info-message"),r=d.closest(".introImageAndCaption, #vrtx-resource\\.picture");if(null!=e){var o=e.naturalWidth||e.width,a=e.naturalHeight||e.height;if(isLocalUrl(v))altTextFromImage(d.closest(".vrtx-image-ref, .introImageAndCaption, #vrtx-resource\\.picture").find(".pictureAlt input[type='text'], .boxPictureAlt input[type='text'], .featuredPictureAlt input[type='text']"),l);if(r.length){var s="<p><label>"+vrtxAdmin.messages.editor.image.preview.dimensions+"</label>"+o+" x "+a+" px</p>";if(isLocalUrl(v)&&(s+="<p><a class='vrtx-button vrtx-edit-image-link' href='"+e.src.replace(/\?(.*)$/,"")+"?vrtx=admin&mode=editor&action=edit' target='_blank'>"+vrtxAdmin.messages.editor.image.preview.edit+"</a></p>"),i.length)i.html(s);else $("<div class='vrtx-intro-image-dimensions-edit-link'>"+s+"</div>").insertAfter(r.find(".vrtx-image-ref-preview, #resource\\.picture\\.preview"));t?n.length||$("<div class='vrtx-intro-image-preview-info-message'>"+vrtxAdmin.messages.editor.validation.warnings.image.widthOverNormalMax+"</div>").insertAfter(c):n.remove()}p||showImagePreviewCaption(v,d,u,m)}else r.length&&(i.remove(),n.remove()),hideImagePreviewCaption(d,p,h)})}function hideImagePreviewCaption(e,t,i){if(e.length){var n=t?0:"fast";$("div#"+e[0].id.replace(/\./g,"\\.")+"\\.preview:visible").fadeOut(n);var r=e.closest(".introImageAndCaption, #vrtx-resource\\.picture");if(r.length){i||(r.find(".caption").fadeOut(n),r.find(".hidePicture").fadeOut(n),r.find(".pictureAlt").fadeOut(n));var o=r.find("ul.errors");r.animate({height:59+(o.length?o.outerHeight(!0):0)+"px"},n)}}}function showImagePreviewCaption(e,t,i,n){var r=$("div#"+t[0].id.replace(/\./g,"\\.")+"\\.preview");i.attr("src",e+(vrtxEditor.introImageVersion?"":(-1===e.indexOf("?")?"?":"&")+"vrtx=thumbnail")),i.attr("alt","preview"),vrtxEditor.introImageVersion&&(vrtxEditor.introImageVersion=!1),i.parent().imagesLoaded(function(){r.fadeIn("fast"),showImagePreviewCaptionAnim(t.closest(".introImageAndCaption, #vrtx-resource\\.picture"))}),void 0===n&&t.focus()}function showImagePreviewCaptionAnim(e){if(e.length){e.find(".caption").fadeIn("fast"),e.find(".hidePicture").fadeIn("fast"),e.find(".pictureAlt").fadeIn("fast");var t=e.height(),i=e.css("height","auto").height();e.css("height",t+"px").animate({height:i+"px"},"fast")}}function hasImageCaption(e,t){var i=e.closest(".introImageAndCaption, #vrtx-resource\\.picture");if(i.length){if(t)return""!=i.find(".caption textarea").val();var n=i.find(".caption textarea")[0].id;vrtxEditor.richtextEditorFacade.updateInstance(n);var r=vrtxEditor.richtextEditorFacade.getInstanceValue(n);return null!=r&&""!=r}return!1}function initPictureAddJsonField(e){initBoxPictures(e.find(".boxPictureAlt, .featuredPictureAlt")),hideImagePreviewCaption(e.find("input.preview-image-inputfield"),!0,!0)}function initBoxPictures(e){for(var t=e.length;t--;){var i=$(e[t]),n=i.prev(".vrtx-image-ref");n.addClass("vrtx-image-ref-alt-text"),n.find(".vrtx-image-ref-preview").append(i.remove())}}function resolveAbsoluteUrl(e){if(""===e)return e;var t=/^((https?:)|(\/\/))/.test(e),i=/^\//.test(e);if(t)return e;var n=location.protocol+"//"+location.host.replace("-adm",""),r=location.pathname.replace(/[^\/]*$/,"");return i?n+e:n+r+e}function isLocalUrl(e){return new RegExp("^"+location.protocol+"//"+location.host.replace("-adm","")).test(e)}function setNonCachedUrl(e){var t=vrtxEditor.introImageVersion||+new Date;return-1!==e.indexOf("?")?-1!==e.indexOf("?v=")?e=e.replace(/\?v=(.*)$/,"?v="+t):-1!==e.indexOf("?&v=")?e=e.replace(/&=(.*)$/,"&="+t):e+="&v="+t:e+="?v="+t,e}function altTextFromImage(o,a,e){var s=setupAltTextFromImagePlaceholder(o);"boolean"==typeof e&&!1!==e||(s.removeClass("vrtx-placeholder-extracted-metadata"),s.text(""));var t=vrtxAdmin.propertyQuery+"uri%20=%20"+encodeURIComponent(a)+"&fields=*&format=json-compact&unpublished=true";vrtxAdmin.serverFacade.getJSON(t,{success:function(e,t,i){var n=e.results;if(1===n.length){var r=n[0].properties;r&&(r.pictureAlt?(s.text(r.pictureAlt),showHideExtractedMetadataPlaceholder(o)):retrievePendingOrExtractedMetadata(r,s,o,a))}}})}function retrievePendingOrExtractedMetadata(e,t,i,n){var r=e.extractedMetadata;if(r)if(r.pending){t.hasClass("vrtx-placeholder-loading")||(t.addClass("vrtx-placeholder-loading"),t.text(vrtxAdmin.messages.editor.image.altText.extractedMetadata.pending),showHideExtractedMetadataPlaceholder(i));setTimeout(function(){i.is(":visible")&&altTextFromImage(i,n,!0)},2e3)}else{t.removeClass("vrtx-placeholder-loading");var o=r.labelAnnotations;if(o){var a={en:"Image may contain",no:"Bildet kan inneholde"},s="en"===vrtxEditor.contentLanguage?"en":"no",l="en"==s?"no":"en";if(o[s]){t.addClass("vrtx-placeholder-extracted-metadata");var d=a[s]+": "+o[s].join(", ")+".";t.text(d);var c=a[l]+": "+o[l].join(", ")+".";t.attr("data-other-lang-label-annotations",c)}else t.text("")}else t.text("");showHideExtractedMetadataPlaceholder(i)}}function setupAltTextFromImagePlaceholder(e){var t=e.parent().find(".vrtx-placeholder");if(!t.length){$("<div class='vrtx-placeholder vrtx-placeholder-saved-if-not-user-overwritten'></div>").insertAfter(e);var i=e.parent();i.addClass("vrtx-placeholder-wrapper"),t=i.find(".vrtx-placeholder"),e.on("keyup",showHideExtractedMetadataPlaceholderListener),e.change(showHideExtractedMetadataPlaceholderListener),t.on("click",function(){$(this).parent().find("input[type='text']").focus()})}return e.parent().find("p.helptext").length||$("<p class='helptext'>"+vrtxAdmin.messages.editor.image.altText.helptext+"</p>").insertAfter(e),showHideExtractedMetadataPlaceholder(e),t}function showHideExtractedMetadataPlaceholderListener(){showHideExtractedMetadataPlaceholder($(this))}function showHideExtractedMetadataPlaceholder(e){var t=e.parent().find(".vrtx-placeholder"),i=e.val();t.hasClass("vrtx-placeholder-loading")&&""===i?t.show():!t.hasClass("vrtx-placeholder-extracted-metadata")||i!==t.text()&&i!==t.attr("data-other-lang-label-annotations")?t.hasClass("vrtx-placeholder-extracted-metadata")&&""===i?t.show():""!==i&&t.hide():(e.val(""),t.show())}function setShowHideBooleanNewEditor(e,t,i){0<$("[name="+e+"]").length&&0<$(t).length&&vrtxEditor.initEventHandler("[name="+e+"]",{wrapper:"#editor",callback:function(e,t,i,n){$("#"+i+(t?"-false":"-true"))[0].checked?toggleShowHideBoolean(e,!0,n):$("#"+i+(t?"-true":"-false"))[0].checked&&toggleShowHideBoolean(e,!1,n)},callbackParams:[t,i,e]})}function setShowHideBooleanNewEditorAnd(e,t,i,n){0<$("[name="+e+"]").length&&0<$("[name="+t+"]").length&&vrtxEditor.initEventHandler("[name="+e+"], [name="+t+"]",{wrapper:"#editor",callback:function(e,t,i,n,r){$("#"+e+(n?"-true":"-false"))[0].checked&&$("#"+t+(n?"-true":"-false"))[0].checked?toggleShowHideBoolean(i,!1,r):toggleShowHideBoolean(i,!0,r)},callbackParams:[e,t,i,n]})}function setShowHideBooleanOldEditor(e,t,i){vrtxEditor.initEventHandler(e,{wrapper:"#editor",callback:function(e,t,i){toggleShowHideBoolean(e,void 0===$(t).val(),i)},callbackParams:[t,i]})}function toggleShowHideBoolean(e,t,i){var n=$(e);i?(n.addClass("animate-optimized"),n[t?"show":"hide"]()):new VrtxAnimation({animationSpeed:vrtxAdmin.transitionPropSpeed,elem:n})[t?"topDown":"bottomUp"]()}function getMultipleFieldsBoxesTemplates(){vrtxEditor.multipleFieldsBoxesDeferred||(vrtxEditor.multipleFieldsBoxesDeferred=$.Deferred(),vrtxEditor.multipleFieldsBoxesTemplates=vrtxAdmin.templateEngineFacade.get("multiple-fields-boxes",["string","html","radio","checkbox","dropdown","date","browse","browse-images","add-remove-move","button","add-button","multiple-inputfield","accordion"],vrtxEditor.multipleFieldsBoxesDeferred))}function initMultipleInputFields(){getMultipleFieldsBoxesTemplates(),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-multipleinputfield button.remove",function(e){removeFormField($(e))},"clickOrEnter"),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-multipleinputfield button.movedown",function(e){swapContentTmp($(e),1)},"clickOrEnter"),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-multipleinputfield button.moveup",function(e){swapContentTmp($(e),-1)},"clickOrEnter"),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-multipleinputfield button.browse-resource-ref",function(e){var t=$(e).closest(".vrtx-multipleinputfield"),i=t.find("input.resource_ref");i.length||(i=t.find("input")),browseServer(i.attr("id"),vrtxAdmin.multipleFormGroupingPaths.baseBrowserURL,vrtxAdmin.multipleFormGroupingPaths.baseFolderURL,vrtxAdmin.multipleFormGroupingPaths.basePath)},"clickOrEnter")}$(document).ready(function(){var i=vrtxEditor;if(i.editorForm=$("#editor"),$("#app-content").on("click","#vrtx-simple-editor .vrtx-back a, .vrtx-close-dialog-editor",function(e){$("#vrtx-embedded-cancel-button, #cancel").click(),e.preventDefault()}),i.isInAdmin&&i.editorForm.length){vrtxAdmin.cacheDOMNodesForReuse(),i.editorForm.find(".ui-helper-hidden").filter(":not(:last)").filter(":first").next().addClass("first"),i.initPreviewImage();setTimeout(function(){autocompleteUsernames($(".vrtx-autocomplete-username")),autocompleteTags(".vrtx-autocomplete-tag"),i.initSendToApproval();var e="function"==typeof $.cachedScript?$.cachedScript:$.getScript,t="undefined"==typeof VrtxStickyBar?e("/vrtx/__vrtx/static-resources/js/vrtx-sticky-bar.js"):$.Deferred().resolve();$.when(t).done(function(){new VrtxStickyBar({wrapperId:"#vrtx-editor-title-submit-buttons",stickyClass:"vrtx-sticky-editor-title-submit-buttons",contentsId:"#contents",outerContentsId:"#main"})})},15);i.initEnhancements(),i.richtextEditorFacade.setupMultiple(!0),"undefined"!=typeof CKEDITOR&&vrtxEditor.editorForm&&vrtxEditor.editorForm.length&&vrtxEditor.richtextEditorFacade.setupCTRLS(),$(window).load(function(){if(vrtxEditor.isInAdmin){var e=vrtxAdmin,t=e._$,i=t.Deferred();i.resolve(),t.when("object"==typeof MANUALLY_APPROVE_INITIALIZED?MANUALLY_APPROVE_INITIALIZED:i,"object"==typeof MULTIPLE_INPUT_FIELD_INITIALIZED?MULTIPLE_INPUT_FIELD_INITIALIZED:i,"object"==typeof JSON_ELEMENTS_INITIALIZED?JSON_ELEMENTS_INITIALIZED:i,"object"==typeof DATE_PICKER_INITIALIZED?DATE_PICKER_INITIALIZED:i,"object"==typeof IMAGE_EDITOR_INITIALIZED?IMAGE_EDITOR_INITIALIZED:i).done(function(){e.log({msg:"Editor initialized."}),storeInitPropValues($("#app-content > form, #contents")),vrtxEditor.isReady=!0})}})}else i.richtextEditorFacade.setupMultiple(!1)}),VrtxEditor.prototype.richtextEditorFacade={toolbars:{},divContainerStylesSet:[{}],editorsForInit:[],initSyncMax:15,initAsyncInterval:15,isRightColumn:!1,showRelatedContentRightColumn:!1,hasRelatedContent:!1,setupMultiple:function(e){e&&this.setupMaximizeMinimize(),this.addRightColumnClass();for(var t=0,i=this.editorsForInit.length;t<i&&t<this.initSyncMax;t++)this.setup(this.editorsForInit[t]);if(i>this.initSyncMax){var n=this;setTimeout(function(){n.setup(n.editorsForInit[t]),++t<i&&setTimeout(arguments.callee,n.initAsyncInterval)},n.initAsyncInterval)}},setup:function(e){var t=vrtxEditor,i=(vrtxAdmin.multipleFormGroupingPaths.baseBrowserURL,vrtxAdmin.multipleFormGroupingPaths.baseFolderURL),n=window.location.origin+i+"?vrtx=admin&mode=finder",r=n+"&type-filter=image",o=t.classifyEditorInstance(e);this.init({name:e.name,isReadOnly:e.isReadOnly||!1,linkBrowseUrl:n,imageBrowseUrl:o.isMain?r:null,filebrowserWindowWidth:640,defaultLanguage:e.defaultLanguage,cssFileList:e.cssFileList,height:t.setupEditorHeight(o,e),maxHeight:t.setupEditorMaxHeight(o,e),minHeight:e.isCompleteEditor?50:40,toolbar:t.setupEditorToolbar(o,e),complete:o.isMain,requiresStudyRefPlugin:o.requiresStudyRefPlugin,resizable:t.setupEditorResizable(o,e),baseDocumentUrl:o.isMessage?null:vrtxAdmin.multipleFormGroupingPaths.baseDocURL,isSimple:o.isSimple,isFrontpageBox:o.isFrontpageBox})},init:function(e){var t={};if(t.baseHref=e.baseDocumentUrl,t.contentsCss=e.cssFileList,t.entities=!1,e.isReadOnly&&(t.readOnly=!0),e.linkBrowseUrl&&(t.filebrowserBrowseUrl=e.linkBrowseUrl,t.filebrowserImageBrowseLinkUrl=e.linkBrowseUrl),t.filebrowserWindowWidth=e.filebrowserWindowWidth,e.complete){t.filebrowserImageBrowseUrl=e.imageBrowseUrl,e.requiresStudyRefPlugin?t.extraPlugins="mediaembed,studyreferencecomponent,htmlbuttons,button-h2,button-h3,button-h4,button-h5,button-h6,button-normal,lineutils,widget,image2,mathjax,balloonpanel,a11ychecker,openlink,fullwidthswitch,confighelper":t.extraPlugins="mediaembed,htmlbuttons,button-h2,button-h3,button-h4,button-h5,button-h6,button-normal,lineutils,widget,image2,mathjax,balloonpanel,a11ychecker,openlink,fullwidthswitch,confighelper",t.extraPlugins+=",edit-image-menu-item",t.image2_alignClasses=["image-left","image-center","image-right"],t.image2_captionedClass="image-captioned";var i=vrtxAdmin.multipleFormGroupingPaths.basePath+"&Command=FileUpload&Type=Image&dragndropUpload=1&CurrentFolder="+vrtxAdmin.multipleFormGroupingPaths.baseFolderURL;t.uploadUrl=i,t.stylesSet=this.divContainerStylesSet,e.isSimple?t.format_tags="p;h1;h2;h3;h4;h5;h6;pre;div":t.format_tags="p;h2;h3;h4;h5;h6;pre;div"}else t.extraPlugins="a11ychecker,confighelper",t.removePlugins="elementspath";t.resize_enabled=e.resizable,t.toolbarCanCollapse=!1,t.defaultLanguage="no",e.defaultLanguage&&(t.language=e.defaultLanguage),t.toolbar=e.toolbar,t.height=e.height+"px",t.autoGrow_maxHeight=e.maxHeight+"px",t.autoGrow_minHeight=e.minHeight+"px",t.forcePasteAsPlainText=!1,t.disableObjectResizing=!0,t.disableNativeSpellChecker=!1,t.pasteFromWordRemoveFontStyles=!0,t.allowedContent=!0,t.linkShowTargetTab=!1,t.keystrokes=[[CKEDITOR.CTRL+50,"button-h2"],[CKEDITOR.CTRL+51,"button-h3"],[CKEDITOR.CTRL+52,"button-h4"],[CKEDITOR.CTRL+53,"button-h5"],[CKEDITOR.CTRL+54,"button-h6"],[CKEDITOR.CTRL+49,"button-normal"]],"object"==typeof vrtxAdmin&&vrtxAdmin.messages&&vrtxAdmin.messages.editor&&vrtxAdmin.messages.editor.placeholder[e.name]&&(t.placeholder=vrtxAdmin.messages.editor.placeholder[e.name]);var n=this;t.on={instanceReady:function(e){n.setupTagsFormatting(this,["p","h1","h2","h3","h4","h5","h6"],!1),n.setupTagsFormatting(this,["ol","ul","li"],!0)}},t.bodyClass=e.name,t.bodyId="main",this.isInstance(e.name)||CKEDITOR.replace(e.name,t)},setupTagsFormatting:function(e,t,i){for(key in t)e.dataProcessor.writer.setRules(t[key],{indent:i,breakBeforeOpen:!0,breakAfterOpen:!1,breakBeforeClose:!1,breakAfterClose:!0})},setupCTRLS:function(){function M(e){t.gridFullWidth(e),_$(".cke_contents iframe").contents().find("body").bind("keydown","ctrl+s meta+s",function(e){ctrlSEventHandler(_$,e)}),_$(".cke_contents iframe").contents().find("body").bind("keydown mousedown",$.debounce(150,!0,function(e){vrtxAdmin.editorLastInteraction=+new Date})),e.editor.on("dialogShow",function(e){CKEDITOR.env.ie&&$(e.data._.element.$).find('a[href*="void(0)"]').removeAttr("href");var t=$(e.data._.element.$).find(".cke_dialog_ui_input_select").children("[value='https://']");null!=t[0]&&($(t[0]).insertBefore($(t[0]).prev("option")),$(t[0]).attr("selected","selected"))})}var t=this;CKEDITOR.on("instanceReady",function(e){M(e),t.getInstance(e.editor.name).on("contentDom",M)})},gridAddClass:function(e){$("textarea[name='introduction']").next().find("iframe").contents().find("body").addClass(e),$("textarea[name='content']").next().find("iframe").contents().find("body").addClass(e),$("textarea[name='related-content']").next().find("iframe").contents().find("body").addClass(e),$("body").addClass(e+"-ck")},gridRemoveClass:function(e){$("textarea[name='introduction']").next().find("iframe").contents().find("body").removeClass(e),$("textarea[name='content']").next().find("iframe").contents().find("body").removeClass(e),$("textarea[name='related-content']").next().find("iframe").contents().find("body").removeClass(e),$("body").removeClass(e+"-ck")},gridFullWidth:function(t){var i=this;$(".cke_toolbar .cke_button__fullwidth").each(function(){$(this).closest(".cke_toolbar").addClass("toolbar-fullwidth").hide()});var e=$("textarea[name='"+t.editor.name.replace("resource.","")+"']").next().find("iframe").contents().find("html");if(e.addClass(window.serverInfo?serverInfo.username:""),e.addClass("html-"+t.editor.name.replace("resource.","")),i.updateRightColumn(t.editor.name.replace("resource.","")),"object"==typeof rteGridHooks)for(var n in rteGridHooks)"function"==typeof rteGridHooks[n]&&rteGridHooks[n](i,t.editor);"related-content"==t.editor.name&&(""!=i.getInstanceValue(t.editor.name)&&(i.hasRelatedContent=!0),t.editor.on("change",function(){var e=i.getInstanceValue(t.editor.name);i.hasRelatedContent=""!=$.trim(e)}))},addRightColumnClass:function(){var t=this,e=$("#showAdditionalContent-true"),i=$("#showAdditionalContent-false");e.length&&(e.is(":checked")&&(t.showRelatedContentRightColumn=!0),e.on("click",function(e){t.showRelatedContentRightColumn=$(this).is(":checked")}),i.on("click",function(e){t.showRelatedContentRightColumn=!$(this).is(":checked")}));setInterval(function(){t.showRelatedContentRightColumn&&t.hasRelatedContent?t.isRightColumn||(t.isRightColumn=!0,t.gridAddClass("right-column")):t.isRightColumn&&(t.isRightColumn=!1,t.gridRemoveClass("right-column"))},200)},updateRightColumn:function(e){this.showRelatedContentRightColumn&&this.hasRelatedContent&&("introduction"==e||"content"==e||"related-content"==e)&&$("textarea[name='"+e+"']").next().find("iframe").contents().find("body").addClass("right-column")},setupMaximizeMinimize:function(){vrtxAdmin.cachedAppContent.on("click",".cke_button__maximize.cke_button_on",this.maximize),vrtxAdmin.cachedAppContent.on("click",".cke_button__maximize.cke_button_off",this.minimize)},maximize:function(){var e=vrtxAdmin,t=e._$,i=t("#vrtx-editor-title-submit-buttons");i.hide(),e.cachedBody.addClass("forms-new"),e.cachedBody.addClass("js"),$("html").addClass(window.serverInfo?serverInfo.username:"");var n=t(this).closest(".cke_reset").find(".cke_toolbar_end:last");if(n.find("#editor-help-menu").length)n.find(".ck-injected-save-help").show();else{var r=i.find(".submit-extra-buttons"),o=r.find("#vrtx-save").html(),a="<div id='editor-help-menu' class='js-on'>"+r.find("#editor-help-menu").html()+"</div>";n.append("<div class='ck-injected-save-help'>"+o+a+"</div>");var s=n.find(".ck-injected-save-help > a");s.hasClass("vrtx-button")?s.removeClass("vrtx-focus-button"):s.addClass("vrtx-button")}},minimize:function(){var e=vrtxAdmin._$;e("#vrtx-editor-title-submit-buttons").show();e(this).closest(".cke_reset").find(".ck-injected-save-help").hide()},getInstanceValue:function(e){var t=this.getInstance(e);return null!==t?t.getData():null},updateInstanceByInstance:function(e){e.updateElement()},updateInstance:function(e){var t=this.getInstance(e);null!==t&&t.updateElement()},updateInstances:function(){for(var e in CKEDITOR.instances)CKEDITOR.instances[e].updateElement()},getValue:function(e){return e.getData()},setValue:function(e,t){e.setData(t)},setInstanceValue:function(e,t){var i=this.getInstance(e);null!==i&&null!==t&&i.setData(t)},isInstance:function(e){return null!==this.getInstance(e)},isChanged:function(e){return e.checkDirty()},resetChanged:function(){for(var e in CKEDITOR.instances)CKEDITOR.instances[e].resetDirty()},getInstance:function(e){return CKEDITOR.instances[e]||null},removeInstance:function(e){this.isInstance(e)&&(this.getInstance(e).destroy(),this.isInstance(e)&&this.deleteInstance(e))},deleteInstance:function(e){delete CKEDITOR.instances[e]},swap:function(r,o){var a=this;setTimeout(function(){var e=a.getInstance(r),t=a.getInstance(o),i=e.getData(),n=t.getData();e.setData(n,function(){t.setData(i)})},10)}},vrtxEditor.richtextEditorFacade.toolbars.inlineToolbar=[["PasteText","Link","Unlink","Bold","Italic","Strike","Subscript","Superscript","RemoveFormat","SpecialChar"],["A11ychecker","-","Source"]],vrtxEditor.richtextEditorFacade.toolbars.withoutSubSuperToolbar=[["PasteText","Link","Unlink","Bold","Italic","Strike","SpecialChar"],["A11ychecker","-","Source"]],vrtxEditor.richtextEditorFacade.toolbars.commentsToolbar=[["Source","PasteText","Bold","Italic","Strike","NumberedList","BulletedList","Link","Unlink"]],vrtxEditor.richtextEditorFacade.toolbars.completeToolbar=[["PasteText","PasteFromWord","-","Undo","Redo"],["Replace"],["Link","Unlink","Anchor"],["Image","MediaEmbed","Table","CreateDiv","HorizontalRule","Mathjax","SpecialChar"],["Maximize"],["FullWidth"],["A11ychecker","-","Source"],"/",["Format"],["Bold","Italic","Strike","Subscript","Superscript","TextColor","-","RemoveFormat"],["NumberedList","BulletedList","-","Outdent","Indent","-","Blockquote"]],vrtxEditor.richtextEditorFacade.toolbars.studyToolbar=[["PasteText","PasteFromWord","-","Undo","Redo","-","Replace","RemoveFormat","-","Link","Unlink","Studyreferencecomponent","Anchor","Image","MediaEmbed","CreateDiv","Table","Studytable","HorizontalRule","SpecialChar"],["A11ychecker","-","Source"],["Format","Bold","Italic","Subscript","Superscript","NumberedList","BulletedList","Outdent","Indent","Maximize"]],vrtxEditor.richtextEditorFacade.toolbars.studyRefToolbar=[["PasteText","PasteFromWord","-","Undo","Redo","-","Replace","RemoveFormat","-","Link","Unlink","Studyreferencecomponent","Anchor","Image","MediaEmbed","Table","CreateDiv","HorizontalRule","SpecialChar"],["A11ychecker","-","Source"],["Format","Bold","Italic","Subscript","Superscript","NumberedList","BulletedList","Outdent","Indent","Maximize"]],vrtxEditor.richtextEditorFacade.toolbars.messageToolbar=[["PasteText","Bold","Italic","Strike","RemoveFormat","-","Undo","Redo","-","Link","Unlink","Subscript","Superscript","NumberedList","BulletedList","Outdent","Indent"],["A11ychecker","-","Source"]],vrtxEditor.richtextEditorFacade.toolbars.resourcesTextToolbar=[["PasteText","Bold","Italic","Strike","-","Undo","Redo","-","Link","Unlink","Subscript","Superscript","NumberedList","BulletedList","Outdent","Indent"],["A11ychecker","-","Source"]],vrtxEditor.richtextEditorFacade.divContainerStylesSet=[{name:"Facts left",element:"div",attributes:{class:"vrtx-facts-container vrtx-container-left"}},{name:"Facts right",element:"div",attributes:{class:"vrtx-facts-container vrtx-container-right"}}],VrtxEditor.prototype.setupEditorHeight=function setupEditorHeight(e,t){return t.isCompleteEditor?e.isContent||e.isCourseGroup?400:e.isSupervisorBox?130:e.isCourseDescriptionB?200:220:e.isMessage?250:e.isCaption?55:e.isStudyField||e.isAdditionalContent?150:e.isIntro?121:90},VrtxEditor.prototype.setupEditorMaxHeight=function setupEditorMaxHeight(e){return e.isContent||e.isCourseGroup?800:e.isSupervisorBox?300:400},VrtxEditor.prototype.setupEditorToolbar=function setupEditorToolbar(e){var t=vrtxEditor.richtextEditorFacade.toolbars;return classification.isMain?e.isMessage?t.messageToolbar:e.isCourseDescriptionB||e.isCourseGroup?t.studyRefToolbar:e.isStudyContent?t.studyToolbar:t.completeToolbar:e.isMessage?t.messageToolbar:e.isResourcesText?t.resourcesTextToolbar:e.isStudyField?t.studyToolbar:e.isIntro||e.isCaption?t.inlineToolbar:t.withoutSubSuperToolbar},VrtxEditor.prototype.setupEditorResizable=function setupEditorResizable(e){return classification.isMain||!(e.isCourseDescriptionA||e.isIntro||e.isCaption||e.isMessage||e.isStudyField)},VrtxEditor.prototype.classifyEditorInstance=function classifyEditorInstance(e){var t=this,i=e.name;return classification={},classification.isOldContent="resource.content"===i,classification.isStudyContent="content-study"===i,classification.isContent="content"===i||classification.isOldContent||classification.isStudyContent,classification.isSimple=classification.isOldContent&&e.simple,classification.isFrontpageBox=t.editorForm.hasClass("vrtx-frontpage"),classification.isAdditionalContent=t.contains(i,"additional-content")||t.contains(i,"additionalContents"),classification.isMain=e.isCompleteEditor||classification.isAdditionalContent,classification.isIntro=t.contains(i,"introduction")||t.contains(i,"resource.description")||t.contains(i,"resource.image-description")||t.contains(i,"resource.video-description")||t.contains(i,"resource.audio-description"),classification.isCaption=t.contains(i,"caption"),classification.isMessage=t.contains(i,"message"),classification.isResourcesText=t.contains(i,"vrtxResourcesText"),classification.isSupervisorBox=t.contains("supervisor-box"),classification.isStudyField=t.contains(i,"frist-frekvens-fri")||t.contains(i,"metode-fri")||t.contains(i,"internasjonale-sokere-fri")||t.contains(i,"nordiske-sokere-fri")||t.contains(i,"opptakskrav-fri")||t.contains(i,"generelle-fri")||t.contains(i,"spesielle-fri")||t.contains(i,"politiattest-fri")||t.contains(i,"rangering-sokere-fri")||t.contains(i,"forstevitnemal-kvote-fri")||t.contains(i,"ordinar-kvote-alle-kvalifiserte-fri")||t.contains(i,"innpassing-tidl-utdanning-fri")||t.contains(i,"regelverk-fri")||t.contains(i,"description-en")||t.contains(i,"description-nn")||t.contains(i,"description-no"),classification.isCourseDescriptionA="teachingsemester-other"===i||"examsemester-other"===i||"teaching-language-text-field"===i||"eksamensspraak-text-field"===i||"sensur-text-field"===i||"antall-forsok-trekk-text-field"===i||"tilrettelagt-eksamen-text-field"===i,classification.isCourseDescriptionB="course-content"===i||"learning-outcomes"===i||"opptak-og-adgang-text-field"===i||"ikke-privatist-text-field"===i||"obligatoriske-forkunnskaper-text-field"===i||"recommended-prerequisites-text-field"===i||"overlapping-courses-text-field"===i||"teaching-text-field"===i||"adgang-text-field"===i||"assessment-and-grading"===i||"hjelpemidler-text-field"===i||"eksamensspraak-text-field"===i||"sensur-text-field"===i||"klage-text-field"===i||"ny-utsatt-eksamen-text-field"===i||"antall-forsok-trekk-text-field"===i||"tilrettelagt-eksamen-text-field"===i||"evaluering-av-emnet-text-field"===i||"other-text-field"===i,classification.isCourseGroup="course-group-about"===i||"courses-in-group"===i||"course-group-admission"===i||"relevant-study-programmes"===i||"course-group-other"===i,classification.requiresStudyRefPlugin=classification.isStudyContent||classification.isCourseDescriptionB||classification.isCourseGroup||classification.isStudyField,classification},VrtxEditor.prototype.initPreviewImage=function initPreviewImage(){var t=vrtxAdmin._$;initBoxPictures(t(".boxPictureAlt, .featuredPictureAlt"));var e=t(".introImageAndCaption, #vrtx-resource\\.picture"),n=e.find(".picture-and-caption, .vrtx-image-ref");n.append("<div class='vrtx-intro-image-caption'></div>"),n=$(".vrtx-intro-image-caption");var r=e.find(".caption"),o=e.find(".hidePicture"),a=e.next(".pictureAlt");r.length&&t(r.remove()).insertBefore(n),a.length||(a=e.find(".pictureAlt")),t(a.remove()).insertBefore(n),o.length&&n.append(o.remove()),r.length&&o.length&&(n.append("<div class='vrtx-hide-intro-image-caption-wrapper'><a href='javascript:void(0);' class='vrtx-hide-intro-image-caption'>"+vrtxAdmin.messages.editor.image.advancedSettings.hide+"</a></div>"),t("<div class='vrtx-show-intro-image-caption-wrapper'><a href='javascript:void(0);' class='vrtx-show-intro-image-caption'>"+vrtxAdmin.messages.editor.image.advancedSettings.show+"</a></div>").insertBefore(n)),n.hide();var s=t("input.preview-image-inputfield");for(i=s.length;i--;){var l=s[i].value,d=t(s[i]),c=d.parent(),u=c.parent().find("img");makePreviewImg(l,d,c,u,!0)}eventListen(vrtxAdmin.cachedDoc,"blur","input.preview-image-inputfield",function(e){previewImage(e.id,!0)}),eventListen(vrtxAdmin.cachedDoc,"keyup","input.preview-image-inputfield",function(e){previewImage(e.id)},null,50,!0),eventListen(vrtxAdmin.cachedDoc,"click",".vrtx-edit-image-link",function(e){openPopupScrollable(e.href+"&refresh-parent-intro-image=yes&edit-image-popup=yes",1140,850,"EditImage")}),eventListen(vrtxAdmin.cachedDoc,"click",".vrtx-show-intro-image-caption",function(e){n.show(),t(e).parent().hide(),t(".vrtx-hide-intro-image-caption-wrapper").show(),showImagePreviewCaptionAnim(t(".introImageAndCaption, #vrtx-resource\\.picture"))}),eventListen(vrtxAdmin.cachedDoc,"click",".vrtx-hide-intro-image-caption",function(e){n.hide(),t(e).parent().hide(),t(".vrtx-show-intro-image-caption-wrapper").show(),showImagePreviewCaptionAnim($(".introImageAndCaption, #vrtx-resource\\.picture"))})},VrtxEditor.prototype.initEnhancements=function initEnhancements(){function Ke(t,e,i){t(e+"\\.true").is(":checked")||t("#vrtx-resource\\."+i).slideUp(0,"linear"),n.cachedAppContent.on("click",e+"\\.true",function(e){t(this).is(":checked")||(t("."+i+" .vrtx-multipleinputfield").remove(),t("#resource\\."+i).val(""),t(".vrtx-"+i+"-limit-reached").remove(),t("#vrtx-"+i+"-add").show()),t("#vrtx-resource\\."+i).slideToggle(n.transitionDropdownSpeed,"swing"),e.stopPropagation()})}var n=vrtxAdmin,r=n._$,e=this;if(Ke(r,"#resource\\.display-aggregation","aggregation"),Ke(r,"#resource\\.display-manually-approved","manually-approve-from"),n.cachedAppContent.on("change","#resource\\.courseContext\\.course-status",function(e){var t=r(this),i=new VrtxAnimation({animationSpeed:n.transitionDropdownSpeed,easeIn:"swing",easeOut:"swing",afterIn:function(e){e.__opts.elem.removeClass("hidden")},afterOut:function(e){e.__opts.elem.addClass("hidden")}});"continued-as"===t.val()?(i.updateElem(r("#vrtx-resource\\.courseContext\\.course-continued-as.hidden")),i.topDown()):(i.updateElem(r("#vrtx-resource\\.courseContext\\.course-continued-as:not(.hidden)")),i.bottomUp()),e.stopPropagation()}),r("#resource\\.courseContext\\.course-status").change(),setShowHideBooleanOldEditor("#resource\\.show-subfolder-menu\\.true, #resource\\.show-subfolder-menu\\.unspecified","#vrtx-resource\\.show-subfolder-title","#resource\\.show-subfolder-menu\\.unspecified:checked"),setShowHideBooleanOldEditor("#resource\\.recursive-listing\\.false, #resource\\.recursive-listing\\.true, #resource\\.recursive-listing\\.selected","#vrtx-resource\\.recursive-listing-subfolders","#resource\\.recursive-listing\\.false:checked, #resource\\.recursive-listing\\.true:checked"),setShowHideBooleanOldEditor("#resource\\.display-type\\.unspecified, #resource\\.display-type\\.calendar","#vrtx-resource\\.event-type-title","#resource\\.display-type\\.unspecified:checked"),setShowHideBooleanOldEditor("#resource\\.display-type\\.unspecified, #resource\\.display-type\\.calendar","#vrtx-resource\\.hide-additional-content","#resource\\.display-type\\.unspecified:checked"),e.setShowHideSelectNewEditor(),e.editorForm.hasClass("vrtx-hvordan-soke")||e.editorForm.hasClass("vrtx-hvordan-soke-tilpasset")||e.editorForm.hasClass("vrtx-periodic-table-element"))e.accordionGroupedInit();else if(e.editorForm.hasClass("vrtx-course-description"))setShowHideBooleanNewEditor("course-fee","div.course-fee-amount",!1),e.accordionGroupedInit();else if(e.editorForm.hasClass("vrtx-semester-page"))setShowHideBooleanNewEditor("cloned-course","div.cloned-course-code",!1),e.accordionGroupedInit("[class*=link-box]");else if(e.editorForm.hasClass("vrtx-student-exchange-agreement"))e.accordionGroupedInit(".vrtx-sea-accordion");else if(e.editorForm.hasClass("vrtx-samlet-program")){var t=e.editorForm.find(".samlet-element");e.replaceTag(t,"h6","strong"),e.replaceTag(t,"h5","h6"),e.replaceTag(t,"h4","h5"),e.replaceTag(t,"h3","h4"),e.replaceTag(t,"h2","h3"),e.replaceTag(t,"h1","h2")}else e.editorForm.hasClass("vrtx-frontpage")?e.accordionGroupedInit(".vrtx-sea-accordion","fast"):e.editorForm.hasClass("vrtx-contact-supervisor")&&n.cachedDoc.on("keyup",".vrtx-string.id input[type='text']",$.debounce(50,!0,function(){n.inputUpdateEngine.update({input:$(this),substitutions:{"#":""," ":"-"},toLowerCase:!1})}))},VrtxEditor.prototype.setShowHideSelectNewEditor=function setShowHideSelectNewEditor(){for(var e in this.selectMappings)this.initEventHandler("#"+e,{event:"change",callback:this.showHideSelect})},VrtxEditor.prototype.toggleOnDependentProp=function toggleOnDependentProp(e,t,n){var r=!0;this.initEventHandler("*[name='resource."+t+"']",{event:"change",wrapper:"div#vrtx-resource\\."+t.replace(/\./g,"\\."),callback:function(e,t){var i=$(e);i.length&&toggleShowHideBoolean(t,i.val()==n,r);r=!1},callbackParams:["*[name='resource."+t+"']","#vrtx-resource\\."+e.replace(/\./g,"\\.")]})},VrtxEditor.prototype.showHideSelect=function showHideSelect(e,t){var i=this,n=e.attr("id"),r=i.selectMappings[n];if(r){var o="select-"+n;i.editorForm.hasClass(o)||i.editorForm.addClass(o);for(var a=e.val(),s=0,l=r.length;s<l;s++){var d=o+"-"+r[s],c=i.editorForm.hasClass(d);a===r[s]?c||i.editorForm.addClass(d):c&&i.editorForm.removeClass(d)}}!t&&accordionGrouped&&accordionGrouped.closeActiveHidden()};var userEnrichmentSeperators={url:"%%URL%%",text:"%%TEXT%%"};function enhanceMultipleInputFields(e,t,i,n,r,o,a){var s=$("."+e+" input[type='text']");if(s.length&&!vrtxAdmin.isIE7&&!vrtxAdmin.isIETridentInComp){var l=s.attr("size"),d=s.hasClass("vrtx-multiple-dropdown");t=!d&&t;var c=s.parent();c.hasClass("vrtx-resource-ref-browse")&&(i=!0,s.next().filter(".vrtx-button").hide()),c.addClass("vrtx-multipleinputfields").data("name",e),vrtxEditor.multipleFieldsBoxes[e]={counter:1,limit:n};var u=s.hide().val(),p=r&&r.length?u.split("$$$"):u.split(",");$($.parseHTML(vrtxEditor.htmlFacade.getMultipleInputFieldsAddButton(e,l,i,t,d,JSON.stringify(r,null,2),a),document,!0)).insertAfter(s);for(var m=addFormField,v="",h=!1,f=0,g=p.length;f<g;f++){var x=m(e,g,$.trim(p[f]),l,i,t,d,!0,r,o);v+=x.html,h=x.isEnriched}v=$.parseHTML(v,document,!0),$(v).insertBefore("#vrtx-"+e+"-add"),c.find(".vrtx-multipleinputfield:first").addClass("first");var E=g>=vrtxEditor.multipleFieldsBoxes[e].limit;if(E||o){var b=$("#vrtx-"+e+"-add");E&&$("<p class='vrtx-"+e+"-limit-reached'>"+vrtxAdmin.multipleFormGroupingMessages.limitReached+"</p>").insertBefore(b),b.hide()}c.hasClass("inputfield")?autocompleteUsernames(c.parent().filter(".vrtx-autocomplete-username"),h):autocompleteUsernames(c.filter(".vrtx-autocomplete-username"),h)}}function addFormField(e,t,i,n,r,o,a,s,l,d){var c=$("."+e+" div.vrtx-multipleinputfield"),u="vrtx-"+e+"-",p=vrtxEditor.multipleFieldsBoxes[e].counter;t=s?t:c.length;var m=vrtxEditor.htmlFacade.getMultipleInputfieldsInteractionsButton("remove"," "+e,u,"",vrtxAdmin.multipleFormGroupingMessages.remove),v="",h="",f="";o&&(1<p&&0<t&&(v=vrtxEditor.htmlFacade.getMultipleInputfieldsInteractionsButton("moveup","",u,vrtxAdmin.multipleFormGroupingMessages.moveUp,"<span class='moveup-arrow'></span>")),p<t&&(h=vrtxEditor.htmlFacade.getMultipleInputfieldsInteractionsButton("movedown","",u,vrtxAdmin.multipleFormGroupingMessages.moveDown,"<span class='movedown-arrow'></span>"))),r&&(f=vrtxEditor.htmlFacade.getMultipleInputfieldsInteractionsButton("browse","-resource-ref",u,"",vrtxAdmin.multipleFormGroupingMessages.browse));var g=!1,x=!1,E=!1,b=null;if(l){i&&-1!==i.indexOf("###")&&(i=i.split("###"));var C=addFormFieldUserEnrichment(i,b=jQuery.extend(!0,[],l),g,x,E);g=C.isEnriched,x=C.hasEnrichedText,E=C.hasEnrichedUrl}var I=vrtxEditor.htmlFacade.getMultipleInputfield(e,u,p,i,n,f,m,v,h,a,b,d,x,E);if(vrtxEditor.multipleFieldsBoxes[e].counter++,s)return{html:I,isEnriched:g};if(0<t&&o){var w=c.filter(":last");w.find("button.movedown").length||(h=vrtxEditor.htmlFacade.getMultipleInputfieldsInteractionsButton("movedown","",u,vrtxAdmin.multipleFormGroupingMessages.moveDown,"<span class='movedown-arrow'></span>"),w.append(h))}var y=$("#vrtx-"+e+"-add");$($.parseHTML(I,document,!0)).insertBefore(y),c=$("."+e+" div.vrtx-multipleinputfield"),0===t&&c.filter(":first").addClass("first"),autocompleteUsername(".vrtx-autocomplete-username",u+p),autocompleteUsername(".vrtx-autocomplete-username",u+"id-"+p,g);var k=y.prev().find("input[type='text'], select");k.length&&k[0].focus();var A=t===vrtxEditor.multipleFieldsBoxes[e].limit-1;(A||d)&&(A&&$("<p class='vrtx-"+e+"-limit-reached'>"+vrtxAdmin.multipleFormGroupingMessages.limitReached+"</p>").insertBefore(y),y.hide())}function removeFormField(e){var t=e.closest(".vrtx-multipleinputfields"),i=e.closest(".vrtx-multipleinputfield"),n=t.data("name");i.remove();var r=t.find(".vrtx-multipleinputfield"),o=r.filter(":first");if(o.length){o.hasClass("first")||o.addClass("first");var a=o.find("input[type='text'], select").filter(":first");a.length&&a[0].focus()}r.length===vrtxEditor.multipleFieldsBoxes[n].limit-1&&($(".vrtx-"+n+"-limit-reached").remove(),$("#vrtx-"+n+"-add").show());var s=r.filter(":first").find("button.moveup"),l=r.filter(":last").find("button.movedown");s.length&&s.remove(),l.length&&l.remove()}function swapContentTmp(e,t){for(var i=e.closest(".vrtx-multipleinputfield"),n=0<t?i.next():i.prev(),r=i.find("input"),o=n.find("input"),a=r.length;a--;){var s=r[a].value;r[a].value=o[a].value,o[a].value=s}swapUserEnrichment(i,n,r,o),o.filter(":first")[0].focus()}function addFormFieldUserEnrichment(e,t,i,n,r){var o="",a="",s=userEnrichmentSeperators;if(e&&e.length){var l="object"==typeof e,d=l?e[e.length-1]:e;if(-1!==d.indexOf(s.url))-1!==(o=d.split(s.url))[1].indexOf(s.text)?(a=o[1].split(s.text)[0],o=o[0]):a="",e=[e[0]];else if(-1!==d.indexOf(s.text)){a=d.split(s.text)[0];e=[e[0]]}else l||(e=[e])}else e=[""];var c=0,u=null,p="";for(var m in t){switch(t[m].type){case"enrichedText":i=!0,t[m].enrichedText=!0,u=m,a.length&&(t[m].enrichedTextVal=a,n=!0);break;case"enrichedUrl":i=!0,t[m].enrichedUrl=!0,o.length&&(t[m].enrichedUrlVal=o,r=!0);break;default:t[m].val=e[c],""!=t[m].val&&(p=t[m].val)}c++}return n||r||null==u||""==p||(t[u].enrichedTextVal=p,n=!0),{isEnriched:i,hasEnrichedText:n,hasEnrichedUrl:r}}function swapUserEnrichment(e,t,i,n){var r=e.find(".vrtx-multiple-inputfield-enrichment"),o=t.find(".vrtx-multiple-inputfield-enrichment");if(r.length)if(o.length){var a=r[0].outerHTML;r.replaceWith(o[0].outerHTML),o.replaceWith(a)}else $(i[0]).removeClass("vrtx-multipleinputfield-field-enriched"),$(n[0]).addClass("vrtx-multipleinputfield-field-enriched"),$(r.remove()).insertAfter(t.find(".vrtx-multipleinputfield-json-wrapper").filter(":last"));else o.length&&($(n[0]).removeClass("vrtx-multipleinputfield-field-enriched"),$(i[0]).addClass("vrtx-multipleinputfield-field-enriched"),$(o.remove()).insertAfter(e.find(".vrtx-multipleinputfield-json-wrapper").filter(":last")))}function saveMultipleInputFields(e,t){for(var i=void 0!==e?e.find(".vrtx-multipleinputfields"):$(".vrtx-multipleinputfields"),n="string"==typeof t?t:",",r=0,o=i.length;r<o;r++){var a=$(i[r]),s=a.find("> input, .ui-accordion-content > input");if(s.length){var l=a.find(".vrtx-multipleinputfield");if(l.length){for(var d="",c=0,u=l.length;c<u;c++){var p=$(l[c]),m=p.find("input");m.length||(m=p.find("select"));var v=m.length;if(v){for(var h=0;h<v;h++)d+=$.trim(m[h].value),1<v&&(d+="###");c<u-1&&(d+=n)}}s.val(d)}else s.val("")}}}function initJsonMovableElements(){$.when(vrtxEditor.multipleFieldsBoxesDeferred,vrtxEditor.multipleBoxesTemplatesContractBuilt).done(function(){for(var e=0,t=vrtxEditor.multipleBoxesTemplatesContract.length;e<t;e++){var i=vrtxEditor.multipleBoxesTemplatesContract[e].name,n=$("#"+i);n.append(vrtxEditor.htmlFacade.getJsonBoxesInteractionsButton("add",vrtxAdmin.multipleFormGroupingMessages.add,"<span class='add-arrow'></span>")).find(".vrtx-add-button").data({number:e}),vrtxEditor.multipleFieldsBoxes[i]={counter:n.find(".vrtx-json-element").length,limit:-1}}accordionJsonInit(),JSON_ELEMENTS_INITIALIZED.resolve()}),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-json .vrtx-move-down-button",function(e){swapContent($(e),1)},"clickOrEnter"),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-json .vrtx-move-up-button",function(e){swapContent($(e),-1)},"clickOrEnter"),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-json .vrtx-add-button",addJsonField,"clickOrEnter"),eventListen(vrtxAdmin.cachedAppContent,"click keypress",".vrtx-json .vrtx-remove-button",removeJsonField,"clickOrEnter")}function addJsonField(e){var t=$(e),i=t.closest(".vrtx-json"),n=i.find(".vrtx-json-element").length,r=vrtxEditor.multipleBoxesTemplatesContract[parseInt(t.data("number"),10)],o="",a="",s=r.a,l=[],d=[],c=[],u=[];for(var p in s)switch(a=r.name+"."+s[p].name+"."+vrtxEditor.multipleFieldsBoxes[r.name].counter,o+=vrtxEditor.htmlFacade.getTypeHtml(s[p],a,s[p].isAutocompleteUsername),s[p].type){case"html":l.push(a);break;case"simple_html":d.push(a);break;case"datetime":c.push(a);break;case"boolean":u.push(a)}var m=i&&i.hasClass("vrtx-multiple-immovable"),v=vrtxEditor.htmlFacade.getJsonBoxesInteractionsButton("remove","",vrtxAdmin.multipleFormGroupingMessages.remove),h="vrtx-json-element-"+r.name+"-"+vrtxEditor.multipleFieldsBoxes[r.name].counter,f=o+'<input type="hidden" class="id" value="'+vrtxEditor.multipleFieldsBoxes[r.name].counter+'" />'+v;!m&&0<n&&(f+=vrtxEditor.htmlFacade.getJsonBoxesInteractionsButton("move-up",vrtxAdmin.multipleFormGroupingMessages.moveUp,"<span class='moveup-arrow'></span>"));f="<div class='vrtx-json-element last' id='"+h+"'>"+f+"</div>";var g=i.find(".vrtx-json-element.last");g.length&&g.removeClass("last"),i.find(".vrtx-add-button").before(f);var x=t.closest(".vrtx-json-accordion"),E=x.length;if(!m&&0<n&&g.length){var b=vrtxEditor.htmlFacade.getJsonBoxesInteractionsButton("move-down",vrtxAdmin.multipleFormGroupingMessages.moveDown,"<span class='movedown-arrow'></span>");E?g.find("> div.ui-accordion-content").append(b):g.append(b)}E&&accordionJsonNew(x);var C=l.length,I=d.length,w=c.length,y=vrtxEditor.richtextEditorFacade;if(C||I||w)var k=setTimeout(function(){if($("#"+h+" .vrtx-remove-button").length){for(var e=0;e<C;e++)y.setup({name:l[e],isCompleteEditor:!0,defaultLanguage:requestLang,cssFileList:cssFileList});for(e=0;e<I;e++)y.setup({name:d[e],defaultLanguage:requestLang,cssFileList:cssFileList,simple:!0});datepickerEditor.initFields(c)}else setTimeout(k,25)},25);for(var A in u)-1!=u[A].indexOf("hideCheckBox")&&setDefaultValue(u[A]);initPictureAddJsonField(t.closest(".vrtx-json").find(".vrtx-json-element:last"));var F=$("#"+h).find(".vrtx-autocomplete-username");F.length&&autocompleteUsernames(F,!1),vrtxEditor.multipleFieldsBoxes[r.name].counter++}function removeJsonField(e){for(var t=$(e).closest(".vrtx-json-element"),i=t.closest(".vrtx-json-accordion"),n=i.length,r=t.parent(),o=t.find("textarea"),a=vrtxEditor.richtextEditorFacade,s=0,l=o.length;s<l;s++)a.removeInstance(o[s].name);var d=t.hasClass("last");t.remove(),r.find(".vrtx-json-element:first .vrtx-move-up-button").remove();var c=r.find(".vrtx-json-element:last");c.find(".vrtx-move-down-button").remove(),d&&c.addClass("last"),n&&(accordionJsonRefresh(i.find(".fieldset"),!1),accordionJson.create())}function swapContent(e,t){for(var i=e.closest(".vrtx-json-element"),n=i.closest(".vrtx-json-accordion"),r=n.length,o=0<t?i.next(".vrtx-json-element"):i.prev(".vrtx-json-element"),a=i.find("input.id").val(),s=o.find("input.id").val(),l=vrtxEditor.multipleBoxesTemplatesContract[parseInt(i.closest(".vrtx-json").find(".vrtx-add-button").data("number"),10)],d=l.a,c=swapElement,u=swapElementCheckbox,p=vrtxEditor.richtextEditorFacade,m=!1,v=0,h=d.length;v<h;v++){var f=l.name+"\\."+d[v].name+"\\.",g=f.replace(/\\/g,""),x=-1===f.indexOf("hideCheckBox")?"#"+f+a:"[name='"+f+a+"']",E=-1===f.indexOf("hideCheckBox")?"#"+f+s:"[name='"+f+s+"']",b=$(x),C=$(E),I=g+a,w=g+s;if(p.isInstance(I)&&p.isInstance(w))p.swap(I,w);else if(b.hasClass("date")&&C.hasClass("date")){var y=b.closest(".vrtx-string"),k=C.closest(".vrtx-string");c(y.find(x+"-date"),k.find(E+"-date")),c(y.find(x+"-hours"),k.find(E+"-hours")),c(y.find(x+"-minutes"),k.find(E+"-minutes"))}b.is(":checkbox")?u(b,C):c(b,C),r&&!m&&(accordionJson.updateHeader(b,!0,!1),accordionJson.updateHeader(C,!0,!1),m=!0),b.blur(),C.blur(),b.change(),C.change()}i.focusout(),o.focusout(),r?(vrtxEditor.multipleFieldsBoxesAccordionSwitchThenScrollTo=o,n.find(".fieldset").accordion("option","active",o.index()-1).accordion("option","refresh")):scrollToElm(o)}function swapElement(e,t){var i=e.val();e.val(t.val()),t.val(i)}function swapElementCheckbox(e,t){var i=e.attr("checked"),n=t.attr("checked");"checked"===i?t.attr("checked","checked"):t.removeAttr("checked"),"checked"===n?e.attr("checked","checked"):e.removeAttr("checked")}function scrollToElm(e){if(void 0!==e.offset()){var t=e.offset().top,i=$("#vrtx-editor-title-submit-buttons");if("fixed"===i.css("position")){var n=i.height();t-=n<=t?n:0}$("body").scrollTo(t,250,{easing:"swing",queue:!0,axis:"y",onAfter:function(){vrtxEditor.multipleFieldsBoxesAccordionSwitchThenScrollTo=null}})}}function accordionJsonInit(){accordionContentSplitHeaderPopulators(!0),accordionJsonRefresh($(".vrtx-json-accordion .fieldset"),!1);for(var e=$(".vrtx-json-accordion .vrtx-json-element"),t=e.length;t--;){var i=$(e[t]);i.find("> *").wrapAll("<div />"),accordionJson.updateHeader(i,!0,!0)}accordionJson.create()}function accordionJsonNew(e){var t=e.find(".fieldset"),i=t.find(".vrtx-json-element").filter(":last");i.find("> *").wrapAll("<div />"),i.prepend('<div class="header">'+("en"!==vrtxAdmin.lang?"Intet innhold":"No content")+"</div>"),accordionContentSplitHeaderPopulators(!1),accordionJsonRefresh(t,!1),accordionJson.create()}function accordionJsonRefresh(e,t){accordionJson=new VrtxAccordion({elem:e,headerSelector:"> div > .header",activeElem:t,onActivate:function(e,t,i){i.updateHeader(t.oldHeader,!0,!1),vrtxEditor.multipleFieldsBoxesAccordionSwitchThenScrollTo&&scrollToElm(vrtxEditor.multipleFieldsBoxesAccordionSwitchThenScrollTo)}})}function accordionContentSplitHeaderPopulators(e){var t=$("#editor.vrtx-shared-text #shared-text-box .vrtx-json-element"),i=$("#editor.vrtx-semester-page .vrtx-grouped[class*=link-box]");t.length?(e||(t=t.filter(":last")),t.find(".title input").addClass("header-populators"),t.find(".vrtx-html").addClass("header-empty-check-or")):i.length&&(i.find(".vrtx-string input[id*=-title]").addClass("header-populators"),i.find(".vrtx-json-element").addClass("header-empty-check-and"),e&&vrtxAdmin.cachedDoc.on("click",i.find(".vrtx-add-button"),function(e){i.find(".vrtx-json-element:last").addClass("header-empty-check-and")}))}function autocompleteUsernames(e,t){vrtxAdmin._$;for(var i=e.find(".vrtx-textfield"),n=i.length;n--;){var r=i[n].id;permissionsAutocomplete(r,"userNames",vrtxAdmin.usernameAutocompleteParams,!0),"boolean"==typeof t&&t&&enrichedUsersAutocomplete(r,".vrtx-button.add")}}function autocompleteUsername(e,t,i){vrtxAdmin._$(e).find("input#"+t).length&&(permissionsAutocomplete(t,"userNames",vrtxAdmin.usernameAutocompleteParams,!0),"boolean"==typeof i&&i&&enrichedUsersAutocomplete(t,".vrtx-button.add"))}function autocompleteTags(e){for(var t=(0,vrtxAdmin._$)(e).find(".vrtx-textfield"),i=t.length;i--;)setAutoComplete(t[i].id,"tags",vrtxAdmin.tagAutocompleteParams)}VrtxEditor.prototype.htmlFacade={getMultipleInputfieldsInteractionsButton:function(e,t,i,n,r){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.button,{type:e,name:t,idstr:i,title:n,buttonText:r})},getMultipleInputFieldsAddButton:function(e,t,i,n,r,o,a){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates["add-button"],{name:e,size:t,isBrowsable:i,isMovable:n,isDropdown:r,title:vrtxAdmin.multipleFormGroupingMessages.add,buttonText:"<span class='add-arrow'></span>",json:o,isResettable:"boolean"==typeof a&&a,resettableLinkText:"en"!==vrtxAdmin.lang?"Tilbakestill forelesere fra TP":"Reset staff from TP"})},getJsonBoxesInteractionsButton:function(e,t,i){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates["add-remove-move"],{clazz:e,title:t,buttonText:i})},getAccordionInteraction:function(e,t,i,n,r){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.accordion,{level:e,id:t,clazz:i,title:n,content:r})},getMultipleInputfield:function(e,t,i,n,r,o,a,s,l,d,c,u,p,m){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates["multiple-inputfield"],{idstr:t,i:i,value:n,size:r,browseButton:o,removeButton:a,moveUpButton:s,moveDownButton:l,isDropdown:d,dropdownArray:"dropdown"+e,json:c,isReadOnly:u,hasEnrichedText:p,hasEnrichedUrl:m})},getTypeHtml:function(e,t,i){var n="get"+this.typeToMethodName(e.type)+"Field";return"getBooleanField"==[n]&&(n="get"+this.typeToMethodName("Checkbox")+"Field"),this[n]?"boolean"==typeof i?this[n](e,t,i):this[n](e,t):""},typeToMethodName:function(e){return e.replace("_"," ").replace(/(\w)(\w*)/g,function(e,t,i){return t.toUpperCase()+i.toLowerCase()}).replace(" ","")},getStringField:function(e,t,i){return e.dropdown&&e.valuemap?this.getDropdown(e,t):vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.string,{classes:"vrtx-string "+e.name+("boolean"==typeof i?" vrtx-autocomplete-username":""),elemTitle:e.title,inputFieldName:t,elemId:e.id||t,elemVal:e.val,elemSize:e.size||40,elemDivide:e.divide,elemPlaceholder:e.placeholder,elemReadOnly:e.readOnly})},getSimpleHtmlField:function(e,t){return this.getHtmlField(e,t,"vrtx-simple-html")},getHtmlField:function(e,t,i){return void 0===i&&(i="vrtx-html"),vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.html,{classes:i+" "+e.name,elemTitle:e.title,inputFieldName:t,elemId:e.id||t,elemDivide:e.divide,elemVal:e.val})},getCheckboxField:function(e,t){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.checkbox,{elemTitle:e.title,elemId:e.id||t,elemChecked:e.checked,elemTooltip:e.tooltip,elemDivide:e.divide,inputFieldName:t})},getDropdown:function(e,t){var i=[];for(var n in e.valuemap){var r=e.valuemap[n].split("$");i.push({key:r[0],value:r[1]})}return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.dropdown,{classes:"vrtx-string "+e.name,elemTitle:e.title,inputFieldName:t,options:i})},getDatetimeField:function(e,t){return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates.date,{elemTitle:e.title,inputFieldName:t})},getImageRefField:function(e,t){return this.getBrowseField(e,t,"browse-images","vrtx-image-ref","image",30,{previewTitle:browseImagesPreview})},getResourceRefField:function(e,t){return this.getBrowseField(e,t,"browse","vrtx-resource-ref",void 0,40,{})},getMediaRefField:function(e,t){return this.getBrowseField(e,t,"browse","vrtx-media-ref","media",30,{})},getBrowseField:function(e,t,i,n,r,o,a){var s={clazz:n,elemTitle:e.title,inputFieldName:t,baseCKURL:vrtxAdmin.multipleFormGroupingPaths.baseBrowserURL,baseFolderURL:vrtxAdmin.multipleFormGroupingPaths.baseFolderURL,basePath:vrtxAdmin.multipleFormGroupingPaths.basePath,browseButtonText:vrtxAdmin.multipleFormGroupingMessages.browse,type:r,size:o};for(var l in a)s[l]=a[l];return vrtxAdmin.templateEngineFacade.render(vrtxEditor.multipleFieldsBoxesTemplates[i],s)}},VrtxEditor.prototype.accordionGroupedInit=function accordionGroupedInit(e,t){vrtxAdmin._$;var i="accordion-grouped",n=".vrtx-grouped"+(void 0!==e?e:"")+", .vrtx-pseudo-grouped"+(void 0!==e?e:""),r=this.editorForm.find(n);r.wrapAll("<div id='"+i+"' />"),accordionContentSplitHeaderPopulators(!0);var o={elem:this.editorForm.find("#"+i),headerSelector:"> div > .header",onActivate:function(e,t,i){accordionGrouped.updateHeader(t.oldHeader,!1,!1)}};void 0!==t&&"fast"===t&&(o.animationSpeed=200),accordionGrouped=new VrtxAccordion(o);for(var a=r.length;a--;){var s=$(r[a]);s.hasClass("vrtx-json")&&s.prepend(s.find(".header").remove()),s.hasClass("vrtx-pseudo-grouped")?(s.find("> label").wrap("<div class='header' />"),s.addClass("vrtx-grouped")):s.find("> *:not(.header)").wrapAll("<div />"),accordionGrouped.updateHeader(s,!1,!0)}accordionGrouped.create(),o.elem.addClass("fast")},VrtxEditor.prototype.initSendToApproval=function initSendToApproval(){var e=vrtxAdmin,t=e._$;e.cachedDoc.on("click","#vrtx-send-to-approval, #vrtx-send-to-approval-global",function(e){vrtxEditor.openSendToApproval(this),e.stopPropagation(),e.preventDefault()}),e.cachedDoc.on("click","#dialog-html-send-approval-content .vrtx-focus-button",function(e){vrtxEditor.saveSendToApproval(t(this)),e.stopPropagation(),e.preventDefault()})},VrtxEditor.prototype.openSendToApproval=function openSendToApproval(n){var r=vrtxAdmin,o=r._$,a=n.id+"-content",s=o("#"+a);s.length?vrtxEditor.openSendToApprovalOpen(s,n):r.serverFacade.getHtml(n.href,{success:function(e,t,i){r.cachedBody.append("<div id='"+a+"'>"+o(o.parseHTML(e)).find("#contents").html()+"</div>"),(s=o("#"+a)).hide(),vrtxEditor.openSendToApprovalOpen(s,n)}})},VrtxEditor.prototype.openSendToApprovalOpen=function openSendToApprovalOpen(e,t){var i=vrtxAdmin._$,n=e.find("#emailFrom").length;new VrtxHtmlDialog({name:"send-approval",html:e.html(),title:t.title,width:430,height:620}).open();var r=i(".ui-dialog");0<r.find("#emailTo").val().length&&(n?r.find("#emailFrom")[0].focus():r.find("#yourCommentTxtArea")[0].focus())},VrtxEditor.prototype.saveSendToApproval=function saveSendToApproval(e){var t=vrtxAdmin,o=t._$,a=e.closest("form"),i=a.attr("action"),n=a.serialize();t.serverFacade.postHtml(i,n,{success:function(e,t,i){var n=a.parent();n.html(o($.parseHTML(e)).find("#contents").html());var r=n.find("#email-approval-success");r.length&&(r.trigger("click"),setTimeout(function(){o("#vrtx-save-view-shortcut").trigger("click")},250))}})},VrtxEditor.prototype.contains=function contains(e,t){return-1!=e.indexOf(t)},VrtxEditor.prototype.replaceTag=function replaceTag(e,t,i){e.find(t).replaceWith(function(){return"<"+i+">"+$(this).text()+"</"+i+">"})},VrtxEditor.prototype.initEventHandler=function initEventHandler(e,t){var i=$(e);if(i.length){t.event=t.event||"click",t.wrapper=t.wrapper||document,t.callbackParams=t.callbackParams||[$(e)],t.callbackChange=t.callbackChange||function(e){};var n=this;t.callback.apply(n,t.callbackParams,!0),$(t.wrapper).on(t.event,i,function(){t.callback.apply(n,t.callbackParams,!1)})}},function(e,t){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",t):"object"==typeof module&&module.exports?module.exports=t():e.EvEmitter=t()}("undefined"!=typeof window?window:this,function(){function e(){}var t=e.prototype;return t.on=function(e,t){if(e&&t){var i=this._events=this._events||{},n=i[e]=i[e]||[];return-1==n.indexOf(t)&&n.push(t),this}},t.once=function(e,t){if(e&&t){this.on(e,t);var i=this._onceEvents=this._onceEvents||{};return(i[e]=i[e]||{})[t]=!0,this}},t.off=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){var n=i.indexOf(t);return-1!=n&&i.splice(n,1),this}},t.emitEvent=function(e,t){var i=this._events&&this._events[e];if(i&&i.length){i=i.slice(0),t=t||[];for(var n=this._onceEvents&&this._onceEvents[e],r=0;r<i.length;r++){var o=i[r];n&&n[o]&&(this.off(e,o),delete n[o]),o.apply(this,t)}return this}},t.allOff=function(){delete this._events,delete this._onceEvents},e}),function(t,i){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(e){return i(t,e)}):"object"==typeof module&&module.exports?module.exports=i(t,require("ev-emitter")):t.imagesLoaded=i(t,t.EvEmitter)}("undefined"!=typeof window?window:this,function(t,e){function i(e,t){for(var i in t)e[i]=t[i];return e}function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);var r=e;return"string"==typeof e&&(r=document.querySelectorAll(e)),r?(this.elements=function n(e){return Array.isArray(e)?e:"object"==typeof e&&"number"==typeof e.length?d.call(e):[e]}(r),this.options=i({},this.options),"function"==typeof t?n=t:i(this.options,t),n&&this.on("always",n),this.getImages(),a&&(this.jqDeferred=new a.Deferred),void setTimeout(this.check.bind(this))):void l.error("Bad element for imagesLoaded "+(r||e))}function r(e){this.img=e}function s(e,t){this.url=e,this.element=t,this.img=new Image}var a=t.jQuery,l=t.console,d=Array.prototype.slice;(o.prototype=Object.create(e.prototype)).options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(e){"IMG"==e.nodeName&&this.addImage(e),!0===this.options.background&&this.addElementBackgroundImages(e);var t=e.nodeType;if(t&&c[t]){for(var i=e.querySelectorAll("img"),n=0;n<i.length;n++){var r=i[n];this.addImage(r)}if("string"==typeof this.options.background){var o=e.querySelectorAll(this.options.background);for(n=0;n<o.length;n++){var a=o[n];this.addElementBackgroundImages(a)}}}};var c={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(e){var t=getComputedStyle(e);if(t)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(t.backgroundImage);null!==n;){var r=n&&n[2];r&&this.addBackground(r,e),n=i.exec(t.backgroundImage)}},o.prototype.addImage=function(e){var t=new r(e);this.images.push(t)},o.prototype.addBackground=function(e,t){var i=new s(e,t);this.images.push(i)},o.prototype.check=function(){function e(e,t,i){setTimeout(function(){n.progress(e,t,i)})}var n=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(t){t.once("progress",e),t.check()}):void this.complete()},o.prototype.progress=function(e,t,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded,this.emitEvent("progress",[this,e,t]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,e),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&l&&l.log("progress: "+i,e,t)},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(e,[this]),this.emitEvent("always",[this]),this.jqDeferred){var t=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[t](this)}},(r.prototype=Object.create(e.prototype)).check=function(){return this.getIsImageComplete()?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&this.img.naturalWidth},r.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.img,t])},r.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},(s.prototype=Object.create(r.prototype)).check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url,this.getIsImageComplete()&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(e,t){this.isLoaded=e,this.emitEvent("progress",[this,this.element,t])},o.makeJQueryPlugin=function(e){(e=e||t.jQuery)&&((a=e).fn.imagesLoaded=function(e,t){return new o(this,e,t).jqDeferred.promise(a(this))})},o.makeJQueryPlugin(),o});